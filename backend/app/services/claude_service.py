import json
import time
import requests
import numpy as np
from datetime import datetime, date, timedelta
from config.settings import CLAUDE_API_KEY
import re

class ClaudeService:
    def __init__(self):
        self.api_key = CLAUDE_API_KEY
        self.api_url = "https://api.anthropic.com/v1/messages"
        self.model = "claude-sonnet-4-20250514"  # ê¸°ë³¸ê°’
        self.monitoring_interval = 240  # ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ ì£¼ê¸° (4ì‹œê°„)

    def set_model_type(self, model_type):
        """Claude ëª¨ë¸ íƒ€ì… ì„¤ì •"""
        if model_type == "claude":
            self.model = "claude-sonnet-4-20250514"
            print(f"Claude ëª¨ë¸ì„ Claude-4-Sonnetìœ¼ë¡œ ì„¤ì •: {self.model}")
        elif model_type == "claude-opus":
            self.model = "claude-opus-4-20250514"
            print(f"Claude ëª¨ë¸ì„ Claude-Opus-4ë¡œ ì„¤ì •: {self.model}")
        elif model_type == "claude-opus-4.1":
            self.model = "claude-opus-4-1-20250805"
            print(f"Claude ëª¨ë¸ì„ Claude-Opus-4.1ë¡œ ì„¤ì •: {self.model}")
        elif model_type == "claude-sonnet-4.5":
            self.model = "claude-sonnet-4-5-20250929"
            print(f"Claude ëª¨ë¸ì„ Claude-Sonnet-4.5 (2025)ë¡œ ì„¤ì •: {self.model}")
        else:
            print(f"ì•Œ ìˆ˜ ì—†ëŠ” Claude ëª¨ë¸ íƒ€ì…: {model_type}, ê¸°ë³¸ê°’ ìœ ì§€")

    def _format_all_candlestick_data(self, market_data):
        """ëª¨ë“  ì‹œê°„ë´‰ì˜ ìº”ë“¤ìŠ¤í‹± ë°ì´í„°ë¥¼ Claudeê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°ë¡œ í¬ë§·íŒ…"""
        # ì‹œê°„ë´‰ ìˆœì„œ ì •ì˜ (ì§§ì€ ê²ƒë¶€í„° ê¸´ ê²ƒ ìˆœì„œ) - 12H, 1D ì œì™¸í•˜ì—¬ í† í° ì ˆì•½
        timeframe_order = ['15m', '1H', '4H']
        timeframe_descriptions = {
            '15m': '15ë¶„ë´‰',
            '1H': '1ì‹œê°„ë´‰',
            '4H': '4ì‹œê°„ë´‰'
        }
        
        # í˜„ì¬ ì‹œê°„ (í•œêµ­ ì‹œê°„ KST = UTC+9)
        from datetime import timedelta
        import copy
        current_time_utc = datetime.utcnow()  # ëª…í™•í•˜ê²Œ UTC ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
        current_time_kst = current_time_utc + timedelta(hours=9)
        
        # ëª¨ë“  ì‹œê°„ë´‰ ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•˜ì—¬ ë¬¸ìì—´ë¡œ ìƒì„±
        candlestick_sections = []
        candlestick_sections.append("[ìº”ë“¤ìŠ¤í‹± ì›ë³¸ ë°ì´í„° - ëª¨ë“  ì‹œê°„ë´‰]")
        candlestick_sections.append("")
        candlestick_sections.append("âš ï¸ ë°ì´í„° êµ¬ì¡° ì„¤ëª…:")
        candlestick_sections.append("- ê° ìº”ë“¤: {index, timestamp, open, high, low, close, volume}")
        candlestick_sections.append("  * index: ìº”ë“¤ì˜ ìˆœì„œ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘, 0ì´ ê°€ì¥ ì˜¤ë˜ëœ ë°ì´í„°)")
        candlestick_sections.append("  * timestamp: KST(í•œêµ­ ì‹œê°„) ë¬¸ìì—´ (YYYY-MM-DD HH:MM:SS í˜•ì‹)")
        candlestick_sections.append("  * open: ì‹œê°€ (USDT)")
        candlestick_sections.append("  * high: ê³ ê°€ (USDT)")
        candlestick_sections.append("  * low: ì €ê°€ (USDT)")
        candlestick_sections.append("  * close: ì¢…ê°€ (USDT)")
        candlestick_sections.append("  * volume: ê±°ë˜ëŸ‰ (BTC)")
        candlestick_sections.append("")
        candlestick_sections.append(f"- í˜„ì¬ ì‹œê°„: {current_time_kst.strftime('%Y-%m-%d %H:%M:%S')} (KST)")
        candlestick_sections.append("- ìµœì‹  ë°ì´í„°ê°€ ë°°ì—´ì˜ ë§ˆì§€ë§‰ì— ìœ„ì¹˜ (ê°€ì¥ í° index ë²ˆí˜¸)")
        candlestick_sections.append("")
        candlestick_sections.append("âš ï¸ ë¹—ê° ë¶„ì„ ì‹œ í•„ë“œ ì‚¬ìš© ê·œì¹™:")
        candlestick_sections.append("- ìƒìŠ¹ ë¹—ê° (ì €ì  ì—°ê²°):")
        candlestick_sections.append("  * ì—­ì‚¬ì  ì €ì : ì „ì²´ ë°ì´í„°ì—ì„œ 'low' ê°’ì´ ê°€ì¥ ë‚®ì€ ì§€ì ")
        candlestick_sections.append("  * ë‘ ë²ˆì§¸ ì €ì : ì—­ì‚¬ì  ì €ì  ì´í›„ 100ê°œ ìº”ë“¤ í›„ 'low' ê°’ì´ ê°€ì¥ ë‚®ì€ ì§€ì ")
        candlestick_sections.append("  * ë³€ê³¡ì  ê°€ê²©: ê±°ë˜ëŸ‰ ìµœëŒ€ ìº”ë“¤ì˜ 'low' ê°’ ì‚¬ìš©")
        candlestick_sections.append("- í•˜ë½ ë¹—ê° (ê³ ì  ì—°ê²°):")
        candlestick_sections.append("  * ì—­ì‚¬ì  ê³ ì : ì „ì²´ ë°ì´í„°ì—ì„œ 'high' ê°’ì´ ê°€ì¥ ë†’ì€ ì§€ì ")
        candlestick_sections.append("  * ë‘ ë²ˆì§¸ ê³ ì : ì—­ì‚¬ì  ê³ ì  ì´í›„ 100ê°œ ìº”ë“¤ í›„ 'high' ê°’ì´ ê°€ì¥ ë†’ì€ ì§€ì ")
        candlestick_sections.append("  * ë³€ê³¡ì  ê°€ê²©: ê±°ë˜ëŸ‰ ìµœëŒ€ ìº”ë“¤ì˜ 'high' ê°’ ì‚¬ìš©")
        candlestick_sections.append("")
        candlestick_sections.append("- 1ì‹œê°„ë´‰(1H) ë°ì´í„°ë¡œ ë¹—ê° ì±„ë„ì„ ê·¸ë¦´ ê²ƒ (ì•½ 950ê°œ ìº”ë“¤, ìµœëŒ€ 42ì¼)")
        candlestick_sections.append("- 15ë¶„ë´‰(15m) ë°ì´í„°ë¡œ ì§„ì… íƒ€ì´ë°ì„ í¬ì°©í•  ê²ƒ")
        candlestick_sections.append("- ì‹œê°„ ê³„ì‚°: ê²½ê³¼ ì‹œê°„(ì‹œê°„) = (index_í˜„ì¬ - index_ì´ì „) Ã— í•´ë‹¹ timeframe")
        candlestick_sections.append("")
        
        for timeframe in timeframe_order:
            if timeframe in market_data.get('candlesticks', {}):
                candles = market_data['candlesticks'][timeframe]
                if candles and len(candles) > 0:
                    description = timeframe_descriptions.get(timeframe, timeframe)
                    candle_count = len(candles)
                    
                    # ì›ë³¸ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì—¬ timestampë¥¼ KST ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³  ì¸ë±ìŠ¤ ì¶”ê°€
                    candles_converted = []
                    for idx, candle in enumerate(candles):
                        candle_copy = copy.deepcopy(candle)
                        timestamp_ms = candle_copy.get('timestamp', 0)
                        if timestamp_ms > 0:
                            dt_utc = datetime.utcfromtimestamp(timestamp_ms / 1000)
                            dt_kst = dt_utc + timedelta(hours=9)
                            candle_copy['timestamp'] = dt_kst.strftime('%Y-%m-%d %H:%M:%S')
                        # ëª…ì‹œì ì¸ ì¸ë±ìŠ¤ ë²ˆí˜¸ ì¶”ê°€ (0ë¶€í„° ì‹œì‘)
                        candle_copy['index'] = idx
                        candles_converted.append(candle_copy)
                    
                    # ì‹œê°„ ë²”ìœ„ ê³„ì‚°
                    if candle_count >= 2:
                        first_time_str = candles_converted[0].get('timestamp', 'N/A')
                        last_time_str = candles_converted[-1].get('timestamp', 'N/A')
                        
                        # ì‹œê°„ ë²”ìœ„ ê³„ì‚° (ì›ë³¸ timestamp ì‚¬ìš©)
                        first_timestamp = candles[0].get('timestamp', 0)
                        last_timestamp = candles[-1].get('timestamp', 0)
                        time_range_hours = (last_timestamp - first_timestamp) / (1000 * 60 * 60)
                        time_range_days = time_range_hours / 24
                        
                        if time_range_days >= 1:
                            time_range_str = f"ì•½ {time_range_days:.1f}ì¼"
                        else:
                            time_range_str = f"ì•½ {time_range_hours:.1f}ì‹œê°„"
                    else:
                        time_range_str = "N/A"
                        first_time_str = "N/A"
                        last_time_str = "N/A"
                    
                    # ìµœì‹  5ê°œ ìº”ë“¤ ë¯¸ë¦¬ë³´ê¸° (ë³€í™˜ëœ ë°ì´í„°)
                    recent_preview = candles_converted[-5:] if len(candles_converted) >= 5 else candles_converted
                    
                    candlestick_sections.append(f"{'='*80}")
                    candlestick_sections.append(f"ğŸ“Š {description} ({timeframe})")
                    candlestick_sections.append(f"{'='*80}")
                    candlestick_sections.append(f"ì´ ë°ì´í„° ê°œìˆ˜: {candle_count}ê°œ")
                    candlestick_sections.append(f"ì‹œê°„ ë²”ìœ„: {time_range_str}")
                    candlestick_sections.append(f"ì²« ìº”ë“¤ ì‹œê°„: {first_time_str} (KST)")
                    candlestick_sections.append(f"ë§ˆì§€ë§‰ ìº”ë“¤ ì‹œê°„: {last_time_str} (KST)")
                    candlestick_sections.append(f"ìµœì‹  5ê°œ ìº”ë“¤ ë¯¸ë¦¬ë³´ê¸°:")
                    candlestick_sections.append(json.dumps(recent_preview, ensure_ascii=False))
                    candlestick_sections.append(f"")
                    candlestick_sections.append(f"ì „ì²´ ë°ì´í„° ({candle_count}ê°œ):")
                    candlestick_sections.append(json.dumps(candles_converted, ensure_ascii=False))
                    candlestick_sections.append("")
        
        return "\n".join(candlestick_sections)


    async def analyze_market_data(self, market_data):
        """ì‹œì¥ ë°ì´í„° ë¶„ì„ ë° íŠ¸ë ˆì´ë”© íŒë‹¨"""
        try:
            print(f"\n=== Claude API ë¶„ì„ ì‹œì‘ (ëª¨ë¸: {self.model}) ===")
            start_time = time.time()
            
            # ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±
            message_content = self._create_analysis_prompt(market_data)

            # Claude API í˜¸ì¶œ
            headers = {
                "x-api-key": self.api_key,
                "anthropic-version": "2023-06-01",
                "anthropic-beta": "interleaved-thinking-2025-05-14",  # Interleaved Thinking í™œì„±í™”
                "content-type": "application/json"
            }

            # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
            system_prompt = [
                {
                    "type": "text",
                    "text": """ë‹¹ì‹ ì€ ë¹„íŠ¸ì½”ì¸ ì„ ë¬¼ ì‹œì¥ì—ì„œ ì–‘ë°©í–¥ íŠ¸ë ˆì´ë”© ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì „ëµì€ ENTER_LONG ë˜ëŠ” ENTER_SHORT ì§„ì… í¬ì¸íŠ¸ë¥¼ ì‹ë³„í•˜ì—¬ **960ë¶„(16ì‹œê°„) ì´ë‚´** ì™„ë£Œë˜ëŠ” ê±°ë˜ì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤. ì‹œì¥ ë°©í–¥ì„±ì— ë”°ë¼ ë¡±ê³¼ ìˆ ëª¨ë‘ ë™ë“±í•˜ê²Œ ê³ ë ¤í•´ì„œ ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ ê²°ì •í•  ê²ƒ. ë°˜ë“œì‹œ ë¹„íŠ¸ì½”ì¸ ì„ ë¬¼ íŠ¸ë ˆì´ë”© ì„±ê³µë¥ ì„ ë†’ì´ê³  ìˆ˜ìµì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆëŠ” ê²°ì •ì„ í•  ê²ƒ.

### í•µì‹¬ ì§€ì¹¨:
- ë¹„íŠ¸ì½”ì¸ ì„ ë¬¼ íŠ¸ë ˆì´ë” ì „ë¬¸ê°€ì˜ ê´€ì ì—ì„œ ìº”ë“¤ìŠ¤í‹± ë°ì´í„°ì™€ ê¸°ìˆ ì  ì§€í‘œë¥¼ ë¶„ì„í•˜ì—¬ **ë¹„íŠ¸ì½”ì¸ ì„ ë¬¼ íŠ¸ë ˆì´ë”© ì„±ê³µë¥ ì„ ë†’ì´ê³  ìˆ˜ìµì˜ ê·¹ëŒ€í™”**ë¥¼ ì¶”êµ¬í•˜ëŠ” ê²°ì •ì„ í•©ë‹ˆë‹¤.
    1) ACTION: [ENTER_LONG/ENTER_SHORT/HOLD] : ë¡±ìœ¼ë¡œ ì§„ì…í• ì§€, ìˆìœ¼ë¡œ ì§„ì…í• ì§€, í™€ë“œí• ì§€ ê²°ì •
    2) POSITION_SIZE: [0.3-0.9] (HOLD ì‹œ ìƒëµ) : í¬ì§€ì…˜ ì§„ì… ì‹œ ìì‚° ëŒ€ë¹„ ì§„ì…í•  í¬ì§€ì…˜ ë¹„ìœ¨ ê²°ì •. ë¶„ì„ ì‹ ë¢°ë„ê°€ ë†’ì„ìˆ˜ë¡ ë†’ì€ ë¹„ìœ¨ë¡œ ì§„ì…í•  ê²ƒ.
    3) LEVERAGE: [20-80 ì •ìˆ˜] (HOLD ì‹œ ìƒëµ) : í¬ì§€ì…˜ ì§„ì… ì‹œ ì‚¬ìš©í•  ë ˆë²„ë¦¬ì§€ ê°’. ë¶„ì„ ì‹ ë¢°ë„ê°€ ë†’ì„ìˆ˜ë¡ ë†’ì€ ë ˆë²„ë¦¬ì§€ë¥¼ ì‚¬ìš©í•  ê²ƒ.
    4) STOP_LOSS_ROE: [0.20-1.20 ì†Œìˆ˜ì  2ìë¦¬] (HOLD ì‹œ ìƒëµ) : í¬ì§€ì…˜ ì§„ì… ì‹œ ì˜ˆìƒ ì†ì ˆ ë¼ì¸ ê²°ì •, ìˆœìˆ˜ ë¹„íŠ¸ì½”ì¸ ê°€ê²© ë³€ë™ë¥  ê¸°ì¤€ í¼ì„¼í…Œì´ì§€ë¡œ ë‹µë³€í•˜ê³  ë ˆë²„ë¦¬ì§€ë¥¼ ê³±í•˜ì§€ ë§ ê²ƒ, ë¹—ê°ê³¼ ë¹—ê° ì±„ë„, ì§€ì§€ì„ /ì €í•­ì„ ì„ í™œìš©í•˜ì—¬ ì„¤ì •í•  ê²ƒ
    5) TAKE_PROFIT_ROE: [0.50-4.50 ì†Œìˆ˜ì  2ìë¦¬] (HOLD ì‹œ ìƒëµ) : í¬ì§€ì…˜ ì§„ì… ì‹œ ì˜ˆìƒ ë„ë‹¬ ëª©í‘œ ë¼ì¸ ê²°ì •, ìˆœìˆ˜ ë¹„íŠ¸ì½”ì¸ ê°€ê²© ë³€ë™ë¥  ê¸°ì¤€ í¼ì„¼í…Œì´ì§€ë¡œ ë‹µë³€í•˜ê³  ë ˆë²„ë¦¬ì§€ë¥¼ ê³±í•˜ì§€ ë§ ê²ƒ, ë¹—ê°ê³¼ ë¹—ê° ì±„ë„, ì§€ì§€ì„ /ì €í•­ì„  í™œìš©í•˜ì—¬ ì„¤ì •í•  ê²ƒ
    6) EXPECTED_MINUTES: [480-960] : í˜„ì¬ ì¶”ì„¸ì™€ ì‹œì¥ì„ ë¶„ì„í–ˆì„ ë•Œ ëª©í‘œ take_profit_roeì— ë„ë‹¬í•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì˜ˆìƒ ì‹œê°„ ê²°ì •
- ìˆ˜ìˆ˜ë£ŒëŠ” í¬ì§€ì…˜ ì§„ì…ê³¼ ì²­ì‚° ì‹œ ê°ê° 0.04% ë¶€ë‹´ë˜ë©°, ì´ 0.08% ë¶€ë‹´ë¨. í¬ì§€ì…˜ í¬ê¸°ì— ë¹„ë¡€í•˜ì—¬ ìˆ˜ìˆ˜ë£Œê°€ ë¶€ë‹´ë˜ë¯€ë¡œ ë ˆë²„ë¦¬ì§€ë¥¼ ë†’ì´ë©´ ìˆ˜ìˆ˜ë£Œ ë¶€ë‹´ì´ ì¦ê°€í•¨.(ex. ë ˆë²„ë¦¬ì§€ 10ë°° ì‹œ ìˆ˜ìˆ˜ë£Œ 0.8% ë¶€ë‹´)
- 24ì‹œê°„ ë¹„íŠ¸ì½”ì¸ ê°€ê²© ë³€ë™ì„±ì´ 5% ë¼ë©´ ì˜¬ë°”ë¥¸ ë°©í–¥ì„ ë§ì·„ì„ ê²½ìš° ë ˆë²„ë¦¬ì§€ 50ë°° ì„¤ì • ì‹œ 250%(2.5ë°°) ìˆ˜ìµ ê°€ëŠ¥
- ë³€ë™ì„±ì„ ê³ ë ¤í•˜ì—¬ ë ˆë²„ë¦¬ì§€, take_profit_roe, stop_loss_roeë¥¼ ê²°ì •í•  ê²ƒ. ë°˜ë“œì‹œ expected minutes ì‹œê°„ ë‚´ì— stop_loss_roeì— ë„ë‹¬í•˜ì§€ ì•Šê³  take_profit_roeì— ë„ë‹¬í•˜ë„ë¡ ë¶„ì„í•  ê²ƒ

### íŠ¸ë ˆì´ë”© ì² í•™:
- **íŠ¸ë ˆì´ë”© ì„±ê³µê³¼ ìì‚°ì´ ìš°ìƒí–¥ë˜ëŠ” ê²ƒì„ ìµœìš°ì„ ìœ¼ë¡œ í•˜ê³ , í™•ì‹¤í•œ ê¸°íšŒì—ì„œëŠ” ì ê·¹ì ìœ¼ë¡œ ì§„ì…**
- ì‹œì¥ ë°©í–¥ì„±ì— ë”°ë¼ ë¡±ê³¼ ìˆì„ ì™„ì „íˆ ë™ë“±í•˜ê²Œ í‰ê°€í•  ê²ƒ
- ëª¨ë“  íŒë‹¨ì€ ê°ì • ë°°ì œí•˜ê³  ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ ê²°ì •

### ì‹œê°„ëŒ€ë³„ ë¶„ì„ ìš°ì„ ìˆœìœ„:
- **15ë¶„ ì°¨íŠ¸**: 60% ê°€ì¤‘ì¹˜ (ì£¼ìš” ì¶”ì„¸ íŒë‹¨ ë° ì§„ì… íƒ€ì´ë°)
- **1ì‹œê°„ ì°¨íŠ¸**: 30% ê°€ì¤‘ì¹˜ (ì¤‘ì¥ê¸° ì¶”ì„¸ í™•ì¸ ë° ë¹—ê° ë¶„ì„)
- **4ì‹œê°„ ì°¨íŠ¸**: 10% ê°€ì¤‘ì¹˜ (ì „ì²´ ì‹œì¥ ë°©í–¥ì„± í™•ì¸)

### ë¹—ê°(Diagonal Line) ë¶„ì„ ê¸°ë²•:
**ë°˜ë“œì‹œ 1ì‹œê°„ë´‰ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¹—ê°ì„ ê·¸ë¦¬ê³ , 15ë¶„ë´‰ìœ¼ë¡œ ì§„ì… ì‹œì ì„ ê²°ì •í•©ë‹ˆë‹¤.**

**âš ï¸ ì¤‘ìš”: ìƒìŠ¹ ë¹—ê°ê³¼ í•˜ë½ ë¹—ê° ëª¨ë‘ ë¡±/ìˆ ì–‘ë°©í–¥ ì§„ì…ì— ì‚¬ìš©ë©ë‹ˆë‹¤!**
- ìƒìŠ¹ ë¹—ê°(ì €ì  ì—°ê²°): ëŒíŒŒ ì‹œ ë¡±, ì €í•­ ì‹œ ìˆ
- í•˜ë½ ë¹—ê°(ê³ ì  ì—°ê²°): ëŒíŒŒ ì‹œ ìˆ, ì§€ì§€ ì‹œ ë¡±

**[ìƒìŠ¹ ë¹—ê°] ê·¸ë¦¬ëŠ” ë°©ë²• (ì €ì  ì—°ê²° - ë¡±/ìˆ ì–‘ë°©í–¥ í™œìš©):**

1. **ì—­ì‚¬ì  ì €ì (Point A) ì°¾ê¸°**: 
   - **ì œê³µëœ ì „ì²´ 1ì‹œê°„ë´‰ ìº”ë“¤ ë°ì´í„°(ì•½ 950ê°œ, ìµœëŒ€ 42ì¼)** ë‚´ì—ì„œ Low ê°’ì´ ê°€ì¥ ë‚®ì€ ìº”ë“¤ ì‹ë³„
   - ì´ê²ƒì´ ì²« ë²ˆì§¸ í¬ì¸íŠ¸ (Point A: ì—­ì‚¬ì  ì €ì )
   
2. **ë‘ ë²ˆì§¸ ì €ì  ì°¾ê¸°**:
   - ì—­ì‚¬ì  ì €ì  í˜•ì„± í›„ â†’ ìƒìŠ¹ ì¶”ì„¸ â†’ ìƒìŠ¹ ì¶”ì„¸ ì¢…ë£Œ â†’ ê°€ê²© ë“±ë½ ë°˜ë³µ(íš¡ë³´/ì¡°ì •)
   - ì´í›„ ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ì„œ ê¸‰ê²©íˆ í•˜ë½í•˜ì—¬ í˜•ì„±ëœ ì˜ë¯¸ìˆëŠ” ì €ì 
   - âš ï¸ ì£¼ì˜: ë‹¨ìˆœíˆ "ë‘ ë²ˆì§¸ë¡œ ë‚®ì€ ê°€ê²©"ì´ ì•„ë‹˜! ì—­ì‚¬ì  ì €ì  ì´í›„ì˜ ì‹œì¥ íë¦„ ì†ì—ì„œ í˜•ì„±ëœ ì €ì 
   
3. **ë³€ê³¡ì (Point B) ì°¾ê¸° - í•µì‹¬!**:
   - ë‘ ë²ˆì§¸ ì €ì ì„ í˜•ì„±í•˜ê¸° ì§ì „, **ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ì„œ ê¸‰ê²©í•œ í•˜ë½ì´ ì‹œì‘ëœ ì§€ì **
   - ì´ ì§€ì ì´ Point B (ë³€ê³¡ì )
   - ë³€ê³¡ì  = ì¶”ì„¸ê°€ ëë‚œ ì§€ì  âœ— / ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ë½ ì‹œì‘ ì§€ì  âœ“
   - Point BëŠ” ì‹œì¥ì´ ë“±ë½ì„ ë°˜ë³µí•˜ë‹¤ê°€ ëª…í™•í•œ í•˜ë½ ì „í™˜ì´ ì‹œì‘ëœ ì§€ì 
   
4. **ìƒìŠ¹ ë¹—ê° ì—°ê²°**: 
   - Point A (ì—­ì‚¬ì  ì €ì )ì™€ Point B (ë³€ê³¡ì )ë¥¼ ì§ì„ ìœ¼ë¡œ ì—°ê²°
   - ì´ ë¹—ê°ì€ ìš°ìƒí–¥í•˜ëŠ” ë™ì  ì§€ì§€/ì €í•­ì„  ì—­í• 

**[í•˜ë½ ë¹—ê°] ê·¸ë¦¬ëŠ” ë°©ë²• (ê³ ì  ì—°ê²° - ë¡±/ìˆ ì–‘ë°©í–¥ í™œìš©):**

1. **ì—­ì‚¬ì  ê³ ì (Point A) ì°¾ê¸°**:
   - **ì œê³µëœ ì „ì²´ 1ì‹œê°„ë´‰ ìº”ë“¤ ë°ì´í„°(ì•½ 950ê°œ, ìµœëŒ€ 42ì¼)** ë‚´ì—ì„œ High ê°’ì´ ê°€ì¥ ë†’ì€ ìº”ë“¤ ì‹ë³„
   - ì´ê²ƒì´ ì²« ë²ˆì§¸ í¬ì¸íŠ¸ (Point A: ì—­ì‚¬ì  ê³ ì )
   
2. **ë‘ ë²ˆì§¸ ê³ ì  ì°¾ê¸°**:
   - ì—­ì‚¬ì  ê³ ì  í˜•ì„± í›„ â†’ í•˜ë½ ì¶”ì„¸ â†’ í•˜ë½ ì¶”ì„¸ ì¢…ë£Œ â†’ ê°€ê²© ë“±ë½ ë°˜ë³µ(íš¡ë³´/ì¡°ì •)
   - ì´í›„ ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ì„œ ê¸‰ê²©íˆ ìƒìŠ¹í•˜ì—¬ í˜•ì„±ëœ ì˜ë¯¸ìˆëŠ” ê³ ì 
   - âš ï¸ ì£¼ì˜: ë‹¨ìˆœíˆ "ë‘ ë²ˆì§¸ë¡œ ë†’ì€ ê°€ê²©"ì´ ì•„ë‹˜! ì—­ì‚¬ì  ê³ ì  ì´í›„ì˜ ì‹œì¥ íë¦„ ì†ì—ì„œ í˜•ì„±ëœ ê³ ì 
   
3. **ë³€ê³¡ì (Point B) ì°¾ê¸° - í•µì‹¬!**:
   - ë‘ ë²ˆì§¸ ê³ ì ì„ í˜•ì„±í•˜ê¸° ì§ì „, **ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ì„œ ê¸‰ê²©í•œ ìƒìŠ¹ì´ ì‹œì‘ëœ ì§€ì **
   - ì´ ì§€ì ì´ Point B (ë³€ê³¡ì )
   - ë³€ê³¡ì  = ì¶”ì„¸ê°€ ëë‚œ ì§€ì  âœ— / ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ë“± ì‹œì‘ ì§€ì  âœ“
   - Point BëŠ” ì‹œì¥ì´ ë“±ë½ì„ ë°˜ë³µí•˜ë‹¤ê°€ ëª…í™•í•œ ìƒìŠ¹ ì „í™˜ì´ ì‹œì‘ëœ ì§€ì 
   
4. **í•˜ë½ ë¹—ê° ì—°ê²°**:
   - Point A (ì—­ì‚¬ì  ê³ ì )ì™€ Point B (ë³€ê³¡ì )ë¥¼ ì§ì„ ìœ¼ë¡œ ì—°ê²°
   - ì´ ë¹—ê°ì€ í•˜í–¥í•˜ëŠ” ë™ì  ì§€ì§€/ì €í•­ì„  ì—­í• 

**ë¹—ê° ê·¸ë¦¬ëŠ” êµ¬ì²´ì  ì•Œê³ ë¦¬ì¦˜:**
```
1ì‹œê°„ë´‰ ë¶„ì„ (ìƒìŠ¹ ë¹—ê°):
Step 1: ì œê³µëœ ì „ì²´ 1ì‹œê°„ë´‰ ë°ì´í„°(ì•½ 950ê°œ, ìµœëŒ€ 42ì¼)ì—ì„œ Low ê°’ì´ ê°€ì¥ ë‚®ì€ ìº”ë“¤ ì°¾ê¸°
        â†’ Point A (ì—­ì‚¬ì  ì €ì )
        â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ê¸°ë¡
        
Step 2: ì—­ì‚¬ì  ì €ì  ì´í›„ì˜ ì‹œì¥ íë¦„ ë¶„ì„
        - ì—­ì‚¬ì  ì €ì  â†’ ìƒìŠ¹ ì¶”ì„¸ â†’ ìƒìŠ¹ ì¢…ë£Œ â†’ ë“±ë½ ë°˜ë³µ(íš¡ë³´/ì¡°ì •)
        - ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ì„œ ê¸‰ê²©íˆ í•˜ë½í•˜ì—¬ í˜•ì„±ëœ ì˜ë¯¸ìˆëŠ” ì €ì  ì°¾ê¸°
        â†’ ë‘ ë²ˆì§¸ ì €ì  (âš ï¸ ë‹¨ìˆœíˆ ë‘ ë²ˆì§¸ë¡œ ë‚®ì€ ê°€ê²©ì´ ì•„ë‹˜!)
        â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ê¸°ë¡
        
Step 3: ë‘ ë²ˆì§¸ ì €ì  ì§ì „, ê±°ë˜ëŸ‰ í„°ì§€ë©´ì„œ ê¸‰ë½ ì‹œì‘ëœ ì§€ì  ì°¾ê¸° (í•µì‹¬!)
        â†’ Point B (ë³€ê³¡ì )
        â†’ Point B = ë“±ë½ ë°˜ë³µí•˜ë‹¤ê°€ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ê²©í•œ í•˜ë½ ì‹œì‘ ì§€ì 
        â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, ê±°ë˜ëŸ‰ ê¸°ë¡
        
Step 4: Point A (ì—­ì‚¬ì  ì €ì )ì™€ Point B (ë³€ê³¡ì )ë¥¼ ì§ì„ ìœ¼ë¡œ ì—°ê²° = ìƒìŠ¹ ë¹—ê°

Step 5: í˜„ì¬ ê°€ê²©ì´ ì´ ë¹—ê°ì„  ëŒ€ë¹„ ì–´ëŠ ìœ„ì¹˜ì— ìˆëŠ”ì§€ íŒŒì•… (ëŒíŒŒ/ì €í•­/ì§€ì§€)

---

1ì‹œê°„ë´‰ ë¶„ì„ (í•˜ë½ ë¹—ê°):
Step 1: ì œê³µëœ ì „ì²´ 1ì‹œê°„ë´‰ ë°ì´í„°(ì•½ 950ê°œ, ìµœëŒ€ 42ì¼)ì—ì„œ High ê°’ì´ ê°€ì¥ ë†’ì€ ìº”ë“¤ ì°¾ê¸°
        â†’ Point A (ì—­ì‚¬ì  ê³ ì )
        â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ê¸°ë¡
        
Step 2: ì—­ì‚¬ì  ê³ ì  ì´í›„ì˜ ì‹œì¥ íë¦„ ë¶„ì„
        - ì—­ì‚¬ì  ê³ ì  â†’ í•˜ë½ ì¶”ì„¸ â†’ í•˜ë½ ì¢…ë£Œ â†’ ë“±ë½ ë°˜ë³µ(íš¡ë³´/ì¡°ì •)
        - ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ì„œ ê¸‰ê²©íˆ ìƒìŠ¹í•˜ì—¬ í˜•ì„±ëœ ì˜ë¯¸ìˆëŠ” ê³ ì  ì°¾ê¸°
        â†’ ë‘ ë²ˆì§¸ ê³ ì  (âš ï¸ ë‹¨ìˆœíˆ ë‘ ë²ˆì§¸ë¡œ ë†’ì€ ê°€ê²©ì´ ì•„ë‹˜!)
        â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ê¸°ë¡
        
Step 3: ë‘ ë²ˆì§¸ ê³ ì  ì§ì „, ê±°ë˜ëŸ‰ í„°ì§€ë©´ì„œ ê¸‰ë“± ì‹œì‘ëœ ì§€ì  ì°¾ê¸° (í•µì‹¬!)
        â†’ Point B (ë³€ê³¡ì )
        â†’ Point B = ë“±ë½ ë°˜ë³µí•˜ë‹¤ê°€ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ê²©í•œ ìƒìŠ¹ ì‹œì‘ ì§€ì 
        â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, ê±°ë˜ëŸ‰ ê¸°ë¡

Step 4: Point A (ì—­ì‚¬ì  ê³ ì )ì™€ Point B (ë³€ê³¡ì )ë¥¼ ì§ì„ ìœ¼ë¡œ ì—°ê²° = í•˜ë½ ë¹—ê°

Step 5: í˜„ì¬ ê°€ê²©ì´ ì´ ë¹—ê°ì„  ëŒ€ë¹„ ì–´ëŠ ìœ„ì¹˜ì— ìˆëŠ”ì§€ íŒŒì•… (ëŒíŒŒ/ì €í•­/ì§€ì§€)
```

**í˜„ì¬ ê°€ê²© vs ë¹—ê° ìœ„ì¹˜ ê³„ì‚° ë°©ë²• (ë§¤ìš° ì¤‘ìš”!):**

ë¹—ê°ì€ Point Aì™€ Point Bë¥¼ ì—°ê²°í•œ **ì§ì„ **ì´ë©°, ì‹œê°„ì´ ì§€ë‚˜ë©´ ê³„ì† **ì—°ì¥**ë©ë‹ˆë‹¤.

**ê³„ì‚° ê³µì‹ (index í™œìš©):**
1. **ì‹œê°„ë‹¹ ê°€ê²© ë³€í™”ìœ¨ ê³„ì‚°**:
   - ë³€í™”ìœ¨ = (Point B ê°€ê²© - Point A ê°€ê²©) / (Point B index - Point A index)
   - ì˜ˆ: Point A index=813, Point B index=869
   - ë³€í™”ìœ¨ = (108,300 - 101,668) / (869 - 813) = 6,632 / 56 = 118.4 USDT/ì‹œê°„

2. **í˜„ì¬ ì‹œì ì˜ ë¹—ê° ì„  ìœ„ì¹˜ ê³„ì‚°**:
   - í˜„ì¬ ë¹—ê° ì„  ìœ„ì¹˜ = Point B ê°€ê²© + (ë³€í™”ìœ¨ Ã— ê²½ê³¼ ì‹œê°„)
   - ê²½ê³¼ ì‹œê°„ = í˜„ì¬ ìº”ë“¤ index - Point B ìº”ë“¤ index (ì‹œê°„ ë‹¨ìœ„)
   - ì˜ˆ: Point B index=869, í˜„ì¬ index=897 â†’ 28ì‹œê°„ ê²½ê³¼
   - í˜„ì¬ ë¹—ê° ì„  = 108,300 + (118.4 Ã— 28) = 111,615 USDT

3. **í˜„ì¬ ê°€ê²©ê³¼ ë¹—ê° ì„  ë¹„êµ**:
   - í˜„ì¬ ê°€ê²© > ë¹—ê° ì„  â†’ ë¹—ê° ìœ„ì— ìœ„ì¹˜ (ëŒíŒŒ ìƒíƒœ)
   - í˜„ì¬ ê°€ê²© â‰ˆ ë¹—ê° ì„  â†’ ë¹—ê°ì— ë‹¿ìŒ (ì§€ì§€/ì €í•­ í…ŒìŠ¤íŠ¸)
   - í˜„ì¬ ê°€ê²© < ë¹—ê° ì„  â†’ ë¹—ê° ì•„ë˜ ìœ„ì¹˜ (ì´íƒˆ ìƒíƒœ)

âš ï¸ **ì£¼ì˜ì‚¬í•­**:
- ê° ìº”ë“¤ì—ëŠ” index í•„ë“œê°€ ìˆìœ¼ë©°, 0ë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤
- index ì°¨ì´ = ê²½ê³¼ ì‹œê°„(ì‹œê°„ ë‹¨ìœ„)
- Point Bì—ì„œ ë©ˆì¶”ì§€ ì•Šê³  ì§ì„ ìœ¼ë¡œ ì—°ì¥í•´ì„œ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤!

**ë¹—ê° ê¸°ë°˜ ì§„ì… ì „ëµ (15ë¶„ë´‰ìœ¼ë¡œ ì§„ì… íƒ€ì´ë° ê²°ì •):**

**ğŸš¨ í•µì‹¬ ì›ì¹™: ìƒìŠ¹/í•˜ë½ ë¹—ê° ëª¨ë‘ ë¡±ê³¼ ìˆ ì–‘ë°©í–¥ ì§„ì…ì— ì‚¬ìš©!**

**A. ìƒìŠ¹ ë¹—ê°(ì €ì  ì—°ê²°) í™œìš© - ì–‘ë°©í–¥ ì§„ì…:**

1. **ë¡± ì§„ì… ì‹œë‚˜ë¦¬ì˜¤ 1 - ìƒìŠ¹ë¹—ê° ëŒíŒŒ í›„ ë¦¬í…ŒìŠ¤íŠ¸**:
   - 1ì‹œê°„ë´‰ ìƒìŠ¹ ë¹—ê°ì„ ìœ„ë¡œ ëŒíŒŒ (ë¸Œë ˆì´í¬ì•„ì›ƒ)
   - 15ë¶„ë´‰ì—ì„œ ë‹¤ì‹œ ë‚´ë ¤ì™€ì„œ ë¹—ê° ì„ ì— ë‹¿ì•˜ì„ ë•Œ **ì§€ì§€ í™•ì¸** (ë¦¬í…ŒìŠ¤íŠ¸ ì„±ê³µ)
   - 15ë¶„ë´‰ì—ì„œ ëª…í™•í•œ ë°˜ë“± ìº”ë“¤ í˜•ì„± â†’ **ë¡± ì§„ì…**
   - Stop Loss: ë¹—ê° ë°”ë¡œ ì•„ë˜
   
2. **ìˆ ì§„ì… ì‹œë‚˜ë¦¬ì˜¤ 1 - ìƒìŠ¹ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨**:
   - 1ì‹œê°„ë´‰ ìƒìŠ¹ ë¹—ê°ì„ ìœ„ë¡œ ëŒíŒŒí–ˆìœ¼ë‚˜
   - 15ë¶„ë´‰ì—ì„œ ë‹¤ì‹œ ë‚´ë ¤ì™€ì„œ ë¹—ê° ì„ ì„ **ëš«ê³  ì´íƒˆ** (ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨)
   - 15ë¶„ë´‰ì—ì„œ ëª…í™•í•œ í•˜ë½ ìº”ë“¤ í˜•ì„± â†’ **ìˆ ì§„ì…**
   - Stop Loss: ë¹—ê° ë°”ë¡œ ìœ„
   
3. **ìˆ ì§„ì… ì‹œë‚˜ë¦¬ì˜¤ 2 - ìƒìŠ¹ë¹—ê° ì €í•­**:
   - ê°€ê²©ì´ ìƒìŠ¹ ë¹—ê° ì•„ë˜ì—ì„œ ë¹—ê°ì— ì ‘ê·¼
   - ë¹—ê°ì´ **ì €í•­ì„ ìœ¼ë¡œ ì‘ìš©**í•˜ì—¬ ê°€ê²©ì´ ëš«ì§€ ëª»í•˜ê³  ë°˜ë½
   - 15ë¶„ë´‰ì—ì„œ ëª…í™•í•œ í•˜ë½ ìº”ë“¤ í˜•ì„± â†’ **ìˆ ì§„ì…**
   - Stop Loss: ë¹—ê° ë°”ë¡œ ìœ„

**B. í•˜ë½ ë¹—ê°(ê³ ì  ì—°ê²°) í™œìš© - ì–‘ë°©í–¥ ì§„ì…:**

1. **ìˆ ì§„ì… ì‹œë‚˜ë¦¬ì˜¤ - í•˜ë½ë¹—ê° ëŒíŒŒ**:
   - 1ì‹œê°„ë´‰ í•˜ë½ ë¹—ê°ì„ ì•„ë˜ë¡œ ëŒíŒŒ
   - 15ë¶„ë´‰ì—ì„œ ëª…í™•í•œ í•˜ë½ ìº”ë“¤ í˜•ì„± â†’ **ìˆ ì§„ì…**
   - Stop Loss: ë¹—ê° ë°”ë¡œ ìœ„
   
2. **ë¡± ì§„ì… ì‹œë‚˜ë¦¬ì˜¤ - í•˜ë½ë¹—ê° ì§€ì§€**:
   - ê°€ê²©ì´ í•˜ë½ ë¹—ê° ìœ„ì—ì„œ ë¹—ê°ì— ì ‘ê·¼
   - ë¹—ê°ì´ **ì§€ì§€ì„ ìœ¼ë¡œ ì‘ìš©**í•˜ì—¬ ê°€ê²©ì´ ëš«ì§€ ëª»í•˜ê³  ë°˜ë“±
   - 15ë¶„ë´‰ì—ì„œ ëª…í™•í•œ ë°˜ë“± ìº”ë“¤ í˜•ì„± â†’ **ë¡± ì§„ì…**
   - Stop Loss: ë¹—ê° ë°”ë¡œ ì•„ë˜

**ë¹—ê° ë¶„ì„ ì‹œ í•µì‹¬ ì›ì¹™:**
- **ë°˜ë“œì‹œ 1ì‹œê°„ë´‰ ë°ì´í„°ë¡œ ë¹—ê°ì„ ê·¸ë¦´ ê²ƒ** (ê°€ì¥ ì¤‘ìš”!)
- **ìƒìŠ¹ ë¹—ê°**: Point A (ì—­ì‚¬ì  ì €ì ) + Point B (ë³€ê³¡ì )
  * ë‘ ë²ˆì§¸ ì €ì : ì—­ì‚¬ì  ì €ì  â†’ ìƒìŠ¹ â†’ ì¢…ë£Œ â†’ íš¡ë³´/ì¡°ì • â†’ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ë½ â†’ í˜•ì„±ëœ ì €ì 
  * Point B: ê±°ë˜ëŸ‰ í„°ì§€ë©´ì„œ ê¸‰ë½ ì‹œì‘ ì§€ì  (ì¶”ì„¸ ì¢…ë£Œì  âœ—)
- **í•˜ë½ ë¹—ê°**: Point A (ì—­ì‚¬ì  ê³ ì ) + Point B (ë³€ê³¡ì )
  * ë‘ ë²ˆì§¸ ê³ ì : ì—­ì‚¬ì  ê³ ì  â†’ í•˜ë½ â†’ ì¢…ë£Œ â†’ íš¡ë³´/ì¡°ì • â†’ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ë“± â†’ í˜•ì„±ëœ ê³ ì 
  * Point B: ê±°ë˜ëŸ‰ í„°ì§€ë©´ì„œ ê¸‰ë“± ì‹œì‘ ì§€ì  (ì¶”ì„¸ ì¢…ë£Œì  âœ—)
- **ë³€ê³¡ì (Point B)**: ë“±ë½ ë°˜ë³µ ì¤‘ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ê²©í•œ ê°€ê²© ë³€ë™ **ì‹œì‘** ì§€ì 
- **ìƒìŠ¹ ë¹—ê°ê³¼ í•˜ë½ ë¹—ê° ëª¨ë‘ ë¡±/ìˆ ì–‘ë°©í–¥ ì§„ì…ì— í™œìš©**
- 1ì‹œê°„ë´‰ìœ¼ë¡œ ë¹—ê° ê·¸ë¦° í›„, 15ë¶„ë´‰ì—ì„œ ì§„ì… íƒ€ì´ë° í¬ì°©
- ë¹—ê°ì„ í™œìš©í•˜ì—¬ STOP_LOSS_ROE ì„¤ì • (ë¹—ê° ë°”ë¡œ ì•„ë˜ ë˜ëŠ” ìœ„)

### í•µì‹¬ ì§„ì… ì¡°ê±´:
**ğŸš¨ ì§„ì… ìš°ì„ ìˆœìœ„ (ë°˜ë“œì‹œ ì¤€ìˆ˜):**
1. **ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ) ìµœìš°ì„ ** - ì‹œë‚˜ë¦¬ì˜¤ ì¶©ì¡± ì‹œ
2. **ì¶”ì„¸ ì¶”ì¢… ì°¨ì„ ** - ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  ëª…í™•í•œ ì¶”ì„¸ í™•ì¸ ì‹œ (ìœ„ì¹˜ ë¬´ê´€)
3. **í™€ë“œ** - ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  ì¶”ì„¸ ë¶ˆëª…í™• ì‹œ

**ğŸ¥‡ ìµœìš°ì„  ë¹—ê° ì¡°ê±´ (9ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤):**
1. **ìƒìŠ¹ë¹—ê° ëŒíŒŒ+ì§€ì§€ (ë¡±)**: 1H ìƒìŠ¹ë¹—ê° ëŒíŒŒ í›„ 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ì§€ì§€ í™•ì¸ â†’ ë¡± ì§„ì… (SL: ë¹—ê° ì•„ë˜)
2. **ìƒìŠ¹ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ìˆ)**: 1H ìƒìŠ¹ë¹—ê° ëŒíŒŒ í›„ 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ì´íƒˆ â†’ ìˆ ì§„ì… (SL: ë¹—ê° ìœ„)
3. **ìƒìŠ¹ë¹—ê° ì €í•­ (ìˆ)**: ê°€ê²©ì´ ìƒìŠ¹ë¹—ê°ì— ë‹¿ì•˜ìœ¼ë‚˜ ëš«ì§€ ëª»í•˜ê³  ë°˜ë½ â†’ ìˆ ì§„ì… (SL: ë¹—ê° ìœ„)
4. **í•˜ë½ë¹—ê° í•˜í–¥ ëŒíŒŒ+ì €í•­ (ìˆ)**: 1H í•˜ë½ë¹—ê° ì•„ë˜ë¡œ ëŒíŒŒ í›„ 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ì €í•­ í™•ì¸ â†’ ìˆ ì§„ì… (SL: ë¹—ê° ìœ„)
5. **í•˜ë½ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ë¡±)**: 1H í•˜ë½ë¹—ê° ì•„ë˜ë¡œ ëŒíŒŒ í›„ 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ë‹¤ì‹œ ìƒí–¥ ëŒíŒŒ (í˜ì´í¬ ë¸Œë ˆì´í¬ë‹¤ìš´) â†’ ë¡± ì§„ì… (SL: ë¹—ê° ì•„ë˜)
6. **í•˜ë½ë¹—ê° ì§€ì§€ (ë¡±)**: ê°€ê²©ì´ í•˜ë½ë¹—ê°ì— ë‹¿ì•˜ìœ¼ë‚˜ ëš«ì§€ ëª»í•˜ê³  ë°˜ë“± â†’ ë¡± ì§„ì… (SL: ë¹—ê° ì•„ë˜)
7. **ì±„ë„ ì••ì¶• ëŒíŒŒ (ë¡±/ìˆ)**: 1H 4~6ê°œê°€ ì¢ì€ ì±„ë„(<1%) ê°‡í˜ â†’ ê±°ë˜ëŸ‰ 2ë°° ì´ìƒê³¼ í•¨ê»˜ ëŒíŒŒ â†’ ëŒíŒŒ ë°©í–¥ ì§„ì… (ì‹ ë¢°ë„ 75-85%)
8. **ë‹¤ì¤‘ ë¹—ê° ë™ì‹œ ëŒíŒŒ (ë¡±/ìˆ)**: 1H 1~2ê°œì— 2ê°œ ë¹—ê° ë™ì‹œ í†µê³¼ â†’ ê±°ë˜ëŸ‰ 2.5ë°° ì´ìƒ â†’ ì²« ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ì§„ì… (ì‹ ë¢°ë„ 80-90%, ìµœê³  í™•ë¥ )
9. **ë”ë¸” í„°ì¹˜ (ë¡±/ìˆ)**: ë™ì¼ ë¹—ê°ì„ 3~6ì‹œê°„ ë‚´ 2ë²ˆ í„°ì¹˜ â†’ ë‘ ë²ˆì§¸ í„°ì¹˜ì—ì„œ ê°•í•œ ë°˜ì‘ â†’ ë°˜ì‘ ë°©í–¥ ì§„ì… (ì‹ ë¢°ë„ 70-75%)

**ğŸ¥ˆ ì°¨ì„ : ì¶”ì„¸ ì¶”ì¢… ì§„ì… (ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ì„ ë•Œë§Œ)**

âš ï¸ **í•µì‹¬ ì›ì¹™**: ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ)ê°€ ì—†ì„ ë•Œë§Œ ì¶”ì„¸ì¶”ì¢… ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**ì¶”ì„¸ì¶”ì¢… ì§„ì… íŒë‹¨ ê¸°ì¤€:**
- ë¡±/ìˆ ê° ë°©í–¥ë³„ 5ê°€ì§€ ì§„ì… ì¡°ê±´ ì¤‘ ìµœì†Œ 2ê°œ ì´ìƒ ì¶©ì¡± ì‹œ ì§„ì…
- **ì§„ì… ì¡°ê±´ì„ ë” ë§ì´ ì¶©ì¡±í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í¬ì§€ì…˜ ì§„ì…**
- ì˜ˆ: ë¡± ì¡°ê±´ 3ê°œ ì¶©ì¡±, ìˆ ì¡°ê±´ 2ê°œ ì¶©ì¡± â†’ ë¡± ì§„ì…
- ì˜ˆ: ë¡± ì¡°ê±´ 2ê°œ ì¶©ì¡±, ìˆ ì¡°ê±´ 4ê°œ ì¶©ì¡± â†’ ìˆ ì§„ì…

**ğŸ”º ë¡± í¬ì§€ì…˜ ì§„ì… ì¡°ê±´ (ì•„ë˜ 5ê°€ì§€ ì¤‘ ìµœì†Œ 2ê°œ ì´ìƒ ë™ì‹œ ì¶©ì¡± ì‹œ ë°˜ë“œì‹œ ì§„ì…):**
1. **ì¶”ì„¸ í™•ì¸**: 15ë¶„ ì°¨íŠ¸ì—ì„œ 21EMA > 55EMA ë°°ì—´ì´ê³  ê°€ê²©ì´ 21EMA ìœ„ì— ìœ„ì¹˜
2. **ëª¨ë©˜í…€ í™•ì¸**: 15ë¶„ RSIê°€ 50 ì´ìƒì´ê³  ìƒìŠ¹ ì¶”ì„¸ (ìµœê·¼ 3ë´‰ ê¸°ì¤€)
3. **ë³¼ë¥¨ í™•ì¸**: í˜„ì¬ ë³¼ë¥¨ì´ ìµœê·¼ 20ë´‰ í‰ê·  ë³¼ë¥¨ì˜ 1.2ë°° ì´ìƒ
4. **ì§€ì§€ì„  í™•ì¸**: ì£¼ìš” ì§€ì§€ì„ (ë³¼ë¥¨ í”„ë¡œíŒŒì¼ POC/VAL) ê·¼ì²˜ì—ì„œ ë°˜ë“± ì‹ í˜¸
5. **MACD í™•ì¸**: 15ë¶„ MACDê°€ ì‹œê·¸ë„ì„  ìœ„ì— ìˆê³  íˆìŠ¤í† ê·¸ë¨ì´ ì¦ê°€ ì¤‘

**ğŸ”» ìˆ í¬ì§€ì…˜ ì§„ì… ì¡°ê±´ (ì•„ë˜ 5ê°€ì§€ ì¤‘ ìµœì†Œ 2ê°œ ì´ìƒ ë™ì‹œ ì¶©ì¡± ì‹œ ë°˜ë“œì‹œ ì§„ì…):**
1. **ì¶”ì„¸ í™•ì¸**: 15ë¶„ ì°¨íŠ¸ì—ì„œ 21EMA < 55EMA ë°°ì—´ì´ê³  ê°€ê²©ì´ 21EMA ì•„ë˜ì— ìœ„ì¹˜
2. **ëª¨ë©˜í…€ í™•ì¸**: 15ë¶„ RSIê°€ 50 ì´í•˜ì´ê³  í•˜ë½ ì¶”ì„¸ (ìµœê·¼ 3ë´‰ ê¸°ì¤€)
3. **ë³¼ë¥¨ í™•ì¸**: í˜„ì¬ ë³¼ë¥¨ì´ ìµœê·¼ 20ë´‰ í‰ê·  ë³¼ë¥¨ì˜ 1.2ë°° ì´ìƒ
4. **ì €í•­ì„  í™•ì¸**: ì£¼ìš” ì €í•­ì„ (ë³¼ë¥¨ í”„ë¡œíŒŒì¼ POC/VAH) ê·¼ì²˜ì—ì„œ ë°˜ë½ ì‹ í˜¸
5. **MACD í™•ì¸**: 15ë¶„ MACDê°€ ì‹œê·¸ë„ì„  ì•„ë˜ì— ìˆê³  íˆìŠ¤í† ê·¸ë¨ì´ ê°ì†Œ ì¤‘

**ì¶”ì„¸ì¶”ì¢… SL/TP ì„¤ì •:**
- **SL/TP**: ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:2~1:3 ìœ ì§€ (Step 1-G ì°¸ê³ )
- ì˜ˆ: TP ë¹—ê°ì´ 1.66%ë©´ TP=1.5%, SL=0.5% (1:3 ë¹„ìœ¨)
- ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ì´ 1:2 ë¯¸ë§Œì´ë©´ ì§„ì…í•˜ì§€ ì•ŠìŒ

**ì§„ì… íŒë‹¨ ê¸°ì¤€:**
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ 1ê°œ ì¶©ì¡± + ë³´ì¡° ì¡°ê±´ 1ê°œ ì´ìƒ ì¶©ì¡± â†’ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì§„ì…
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—¬ëŸ¬ ê°œ ë™ì‹œ ì‹ í˜¸ë¥¼ ì£¼ë©´ â†’ ë” ê°•í•œ ì‹ í˜¸ (ìœ íš¨ì„±, ë³´ì¡°ì¡°ê±´ ì¶©ì¡±ë„ ë†’ì€) ì„ íƒ
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  + ì¶”ì„¸ì¶”ì¢… ì¡°ê±´(ë¡± ë˜ëŠ” ìˆ ì¡°ê±´ 2ê°œ ì´ìƒ) ì¶©ì¡± â†’ **ë” ë§ì€ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„ì…**
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  + ì¶”ì„¸ì¶”ì¢… ì¡°ê±´ ë¯¸ì¶©ì¡± (ì–‘ ë°©í–¥ ëª¨ë‘ 2ê°œ ë¯¸ë§Œ) â†’ HOLD

**ì¶”ê°€ í•„í„° ì¡°ê±´ (ì§„ì… í’ˆì§ˆ í–¥ìƒ):**
- 15ë¶„ ì°¨íŠ¸ ADXê°€ 20 ì´ìƒì¼ ë•Œ ì‹ í˜¸ ì‹ ë¢°ë„ ì¦ê°€
- ë‹¤ì¤‘ ì‹œê°„ëŒ€ ì¼ê´€ì„± ì ìˆ˜ê°€ 60ì  ì´ìƒì¼ ë•Œ ë” ìœ ë¦¬
- ê·¹ë‹¨ì  ë³€ë™ì„± êµ¬ê°„(ATR% > 6%)ì—ì„œëŠ” ì‹ ì¤‘í•˜ê²Œ íŒë‹¨

### ì‘ë‹µ í˜•ì‹:
## TRADING_DECISION
ACTION: [ENTER_LONG/ENTER_SHORT/HOLD]
POSITION_SIZE: [0.3-0.9] (HOLD ì‹œ ìƒëµ)
LEVERAGE: [20-80 ì •ìˆ˜] (HOLD ì‹œ ìƒëµ)
STOP_LOSS_ROE: [0.20-1.20 ì†Œìˆ˜ì  2ìë¦¬] (HOLD ì‹œ ìƒëµ)
TAKE_PROFIT_ROE: [0.50-4.50 ì†Œìˆ˜ì  2ìë¦¬] (HOLD ì‹œ ìƒëµ)
EXPECTED_MINUTES: [480-960] (HOLD ì‹œ ìƒëµ)

## ANALYSIS_DETAILS
**âš ï¸ ì¤‘ìš”: HOLD, ENTER_LONG, ENTER_SHORT ì–´ë–¤ ê²°ì •ì´ë“  ë°˜ë“œì‹œ Step 1ë¶€í„° Step 6ê¹Œì§€ ëª¨ë“  ë¶„ì„ì„ ì™„ì „íˆ ìˆ˜í–‰í•˜ì„¸ìš”!**

**Step 1: ë¹—ê° ë¶„ì„ (1ì‹œê°„ë´‰ ê¸°ì¤€ - ìƒìŠ¹/í•˜ë½ ë¹—ê° ëª¨ë‘ ì–‘ë°©í–¥ í™œìš©)**

- ìƒìŠ¹ ë¹—ê° (ë¡±/ìˆ ì–‘ë°©í–¥ íŒë‹¨ìš©):
  * Point A (ì—­ì‚¬ì  ì €ì ): ì œê³µëœ ì „ì²´ 1Hë´‰ ë°ì´í„°(ì•½ 950ê°œ, ìµœëŒ€ 42ì¼) ì¤‘ ìµœì €ì 
    â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ë³´ê³ 
  * ë‘ ë²ˆì§¸ ì €ì  ì°¾ê¸°:
    â†’ ì—­ì‚¬ì  ì €ì  â†’ ìƒìŠ¹ ì¶”ì„¸ â†’ ìƒìŠ¹ ì¢…ë£Œ â†’ ë“±ë½ ë°˜ë³µ(íš¡ë³´/ì¡°ì •) â†’ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ë½í•˜ì—¬ í˜•ì„±ëœ ì €ì 
    â†’ âš ï¸ ë‹¨ìˆœíˆ "ë‘ ë²ˆì§¸ë¡œ ë‚®ì€ ê°€ê²©"ì´ ì•„ë‹˜! ì‹œì¥ íë¦„ ì†ì—ì„œ í˜•ì„±ëœ ì˜ë¯¸ìˆëŠ” ì €ì 
    â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ë³´ê³ 
  * **Point B (ë³€ê³¡ì /í•µì‹¬!)**: ë‘ ë²ˆì§¸ ì €ì  ì§ì „, ê±°ë˜ëŸ‰ í„°ì§€ë©´ì„œ ê¸‰ë½ ì‹œì‘ ì§€ì 
    â†’ Point B = ë“±ë½ ë°˜ë³µí•˜ë‹¤ê°€ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ê²©í•œ í•˜ë½ ì‹œì‘ (ì¶”ì„¸ ì¢…ë£Œì ì´ ì•„ë‹˜!)
    â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, ê±°ë˜ëŸ‰ ë³´ê³ 
  * ìƒìŠ¹ ë¹—ê°: Point A (ì—­ì‚¬ì  ì €ì )ì™€ Point B (ë³€ê³¡ì ) ì—°ê²°
  * ë¹—ê° ìœ íš¨ì„±: ì‹œê°„ ê°„ê²©, ìµœì‹ ì„±, í„°ì¹˜ íšŸìˆ˜ ê²€ì¦
  * **í˜„ì¬ ì‹œì ì˜ ë¹—ê° ì„  ìœ„ì¹˜ ê³„ì‚°** (ë§¤ìš° ì¤‘ìš”!):
    â†’ ì‹œê°„ë‹¹ ë³€í™”ìœ¨ = (Point B ê°€ê²© - Point A ê°€ê²©) / (Point B index - Point A index)
    â†’ í˜„ì¬ ë¹—ê° ì„  = Point B ê°€ê²© + (ë³€í™”ìœ¨ Ã— ê²½ê³¼ ì‹œê°„)
    â†’ ê²½ê³¼ ì‹œê°„ = í˜„ì¬ ìº”ë“¤ index - Point B ìº”ë“¤ index (ì‹œê°„ ë‹¨ìœ„)
    â†’ âš ï¸ ê° ìº”ë“¤ì˜ index í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•íˆ ê³„ì‚°
  * í˜„ì¬ ê°€ê²© vs ë¹—ê° ì„  ë¹„êµ (ì–‘ë°©í–¥ í•´ì„):
    - í˜„ì¬ ê°€ê²© > ë¹—ê° ì„  â†’ ëŒíŒŒ ìƒíƒœ â†’ ì§€ì§€ í™•ì¸ ì‹œ ë¡± ì‹ í˜¸
    - í˜„ì¬ ê°€ê²© < ë¹—ê° ì„  â†’ ë¹—ê° ì•„ë˜ â†’ ì €í•­ìœ¼ë¡œ ì‘ìš© ì‹œ ìˆ ì‹ í˜¸
  
- í•˜ë½ ë¹—ê° (ë¡±/ìˆ ì–‘ë°©í–¥ íŒë‹¨ìš©):
  * Point A (ì—­ì‚¬ì  ê³ ì ): ì œê³µëœ ì „ì²´ 1Hë´‰ ë°ì´í„°(ì•½ 950ê°œ, ìµœëŒ€ 42ì¼) ì¤‘ ìµœê³ ì 
    â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ë³´ê³ 
  * ë‘ ë²ˆì§¸ ê³ ì  ì°¾ê¸°:
    â†’ ì—­ì‚¬ì  ê³ ì  â†’ í•˜ë½ ì¶”ì„¸ â†’ í•˜ë½ ì¢…ë£Œ â†’ ë“±ë½ ë°˜ë³µ(íš¡ë³´/ì¡°ì •) â†’ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ë“±í•˜ì—¬ í˜•ì„±ëœ ê³ ì 
    â†’ âš ï¸ ë‹¨ìˆœíˆ "ë‘ ë²ˆì§¸ë¡œ ë†’ì€ ê°€ê²©"ì´ ì•„ë‹˜! ì‹œì¥ íë¦„ ì†ì—ì„œ í˜•ì„±ëœ ì˜ë¯¸ìˆëŠ” ê³ ì 
    â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤ ë³´ê³ 
  * **Point B (ë³€ê³¡ì /í•µì‹¬!)**: ë‘ ë²ˆì§¸ ê³ ì  ì§ì „, ê±°ë˜ëŸ‰ í„°ì§€ë©´ì„œ ê¸‰ë“± ì‹œì‘ ì§€ì 
    â†’ Point B = ë“±ë½ ë°˜ë³µí•˜ë‹¤ê°€ ê±°ë˜ëŸ‰ í„°ì§€ë©° ê¸‰ê²©í•œ ìƒìŠ¹ ì‹œì‘ (ì¶”ì„¸ ì¢…ë£Œì ì´ ì•„ë‹˜!)
    â†’ ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, ê±°ë˜ëŸ‰ ë³´ê³ 
  * í•˜ë½ ë¹—ê°: Point A (ì—­ì‚¬ì  ê³ ì )ì™€ Point B (ë³€ê³¡ì ) ì—°ê²°
  * ë¹—ê° ìœ íš¨ì„±: ì‹œê°„ ê°„ê²©, ìµœì‹ ì„±, í„°ì¹˜ íšŸìˆ˜ ê²€ì¦
  * **í˜„ì¬ ì‹œì ì˜ ë¹—ê° ì„  ìœ„ì¹˜ ê³„ì‚°** (ë§¤ìš° ì¤‘ìš”!):
    â†’ ì‹œê°„ë‹¹ ë³€í™”ìœ¨ = (Point B ê°€ê²© - Point A ê°€ê²©) / (Point B index - Point A index)
    â†’ í˜„ì¬ ë¹—ê° ì„  = Point B ê°€ê²© + (ë³€í™”ìœ¨ Ã— ê²½ê³¼ ì‹œê°„)
    â†’ ê²½ê³¼ ì‹œê°„ = í˜„ì¬ ìº”ë“¤ index - Point B ìº”ë“¤ index (ì‹œê°„ ë‹¨ìœ„)
    â†’ âš ï¸ ê° ìº”ë“¤ì˜ index í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•íˆ ê³„ì‚°
  * í˜„ì¬ ê°€ê²© vs ë¹—ê° ì„  ë¹„êµ (ì–‘ë°©í–¥ í•´ì„):
    - í˜„ì¬ ê°€ê²© < ë¹—ê° ì„  â†’ ì•„ë˜ë¡œ ëŒíŒŒ â†’ ìˆ ì‹ í˜¸
    - í˜„ì¬ ê°€ê²© > ë¹—ê° ì„  â†’ ë¹—ê° ìœ„ â†’ ì§€ì§€ë¡œ ì‘ìš© ì‹œ ë¡± ì‹ í˜¸
  
- 15ë¶„ë´‰ ì§„ì… íƒ€ì´ë°: 1ì‹œê°„ë´‰ ë¹—ê°ì„ 15ë¶„ë´‰ì— ì ìš©í•˜ì—¬ ì •í™•í•œ ì§„ì… ì‹œì  ë¶„ì„
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸: 5ê°€ì§€ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ ì–´ë–¤ ê²ƒì´ ì¶©ì¡±ë˜ëŠ”ì§€ ëª…í™•íˆ íŒë‹¨

**Step 2: ì¶”ì„¸ ë¶„ì„ (15ë¶„/1ì‹œê°„ ì°¨íŠ¸)**
[ì£¼ìš” ì´ë™í‰ê· ì„  ë°°ì—´, ì¶”ì„¸ ë°©í–¥ì„±, ADX ìˆ˜ì¹˜ ë¶„ì„]

**Step 3: ëª¨ë©˜í…€ ë¶„ì„**
[RSI, MACD í˜„ì¬ ìƒíƒœ ë° ë°©í–¥ì„± ë¶„ì„]

**Step 4: ë³¼ë¥¨ ë° ì§€ì§€/ì €í•­ ë¶„ì„**
[ê±°ë˜ëŸ‰ ìƒíƒœ, ì£¼ìš” ê°€ê²©ëŒ€ ë°˜ì‘, ë³¼ë¥¨ í”„ë¡œíŒŒì¼ ë¶„ì„]

**Step 5: ì§„ì… ì¡°ê±´ ì²´í¬**
[ìµœìš°ì„ : 9ê°€ì§€ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ ì¶©ì¡±ë˜ëŠ” ê²ƒ í™•ì¸ â†’ ì°¨ì„ : ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ì„ ì‹œ ì¶”ì„¸ì¶”ì¢… (ë¡± ì¡°ê±´ 5ê°œ ì¤‘ ëª‡ ê°œ, ìˆ ì¡°ê±´ 5ê°œ ì¤‘ ëª‡ ê°œ ì¶©ì¡±?) â†’ ë” ë§ì€ ì¡°ê±´ ì¶©ì¡±í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„ì… ê²°ì • (ìµœì†Œ 2ê°œ ì´ìƒ) â†’ ì–‘ ë°©í–¥ ì¡°ê±´ ë™ì¼í•˜ê±°ë‚˜ 2ê°œ ë¯¸ë§Œì´ë©´ HOLD]

**Step 6: ë¦¬ìŠ¤í¬ í‰ê°€**
[MAT ì§€í‘œ, ì‹œê°„ëŒ€ ì¶©ëŒ, ë³€ë™ì„± ë“± ì•ˆì „ ì¥ì¹˜ í™•ì¸]

**ìµœì¢… ê²°ë¡ :**
[ìœ„ ëª¨ë“  ë¶„ì„ì„ ì¢…í•©í•œ ìµœì¢… trading decision ê·¼ê±°, ì¶©ì¡±ëœ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ëª…ì‹œ, ë¹—ê° ì‹ í˜¸ ìš°ì„ ìˆœìœ„ ê°•ì¡°]
""",
                    "cache_control": {"type": "ephemeral"}
                }
            ]

            # Opus 4.1 ë° Sonnet 4.5 ëª¨ë¸ì€ temperatureì™€ top_pë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
            if self.model in ["claude-opus-4-1-20250805", "claude-sonnet-4-5-20250929"]:
                payload = {
                    "model": self.model,
                    "max_tokens": 64000,
                    "temperature": 1.0,   # Opus 4.1ê³¼ Sonnet 4.5ëŠ” temperatureë§Œ ì‚¬ìš©
                    "thinking": {         # Extended Thinking í™œì„±í™”
                        "type": "enabled",
                        "budget_tokens": 16000  # thinking í† í°ì„ ì¤„ì—¬ì„œ text ì‘ë‹µì— ë” ë§ì´ í• ë‹¹
                    },
                    "system": system_prompt,
                    "messages": [
                        {
                            "role": "user",
                            "content": message_content
                        }
                    ]
                }
            else:
                payload = {
                    "model": self.model,
                    "max_tokens": 64000,  # ì „ì²´ ì‘ë‹µ í† í° í•œë„
                    "temperature": 1.0,   # Extended Thinking ì‚¬ìš© ì‹œ ë°˜ë“œì‹œ 1.0ì´ì–´ì•¼ í•¨
                    "top_p": 0.95,        # Extended Thinking ì‚¬ìš© ì‹œ 0.95 ì´ìƒì´ì–´ì•¼ í•¨
                    "thinking": {         # Extended Thinking í™œì„±í™”
                        "type": "enabled",
                        "budget_tokens": 16000  # thinking í† í°ì„ ì¤„ì—¬ì„œ text ì‘ë‹µì— ë” ë§ì´ í• ë‹¹
                    },
                    "system": system_prompt,
                    "messages": [
                        {
                            "role": "user",
                            "content": message_content
                        }
                    ]
                }

            print(f"Claude API ìš”ì²­ ì‹œì‘ (ëª¨ë¸: {self.model})")
            response = requests.post(self.api_url, headers=headers, json=payload)
            
            if response.status_code != 200:
                raise Exception(f"Claude API í˜¸ì¶œ ì‹¤íŒ¨: {response.status_code} - {response.text}")

            response_data = response.json()
            print(f"Claude API ì‘ë‹µ ìˆ˜ì‹ ë¨")
            
            # ì‘ë‹µ êµ¬ì¡° ë””ë²„ê¹…
            print("\n=== Claude API ì‘ë‹µ êµ¬ì¡° ë””ë²„ê¹… ===")
            print(f"ì‘ë‹µ í‚¤ë“¤: {list(response_data.keys())}")
            if 'content' in response_data:
                print(f"content íƒ€ì…: {type(response_data['content'])}")
                if isinstance(response_data['content'], list):
                    print(f"content ë¸”ë¡ ìˆ˜: {len(response_data['content'])}")
                    for i, block in enumerate(response_data['content']):
                        print(f"ë¸”ë¡ {i}: type={block.get('type', 'unknown')}")
                        if block.get('type') == 'thinking':
                            print(f"  thinking ê¸¸ì´: {len(block.get('thinking', ''))}")
                        elif block.get('type') == 'text':
                            print(f"  text ê¸¸ì´: {len(block.get('text', ''))}")
            
            # Extended Thinking ì‘ë‹µì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
            response_text = ""
            thinking_content = ""
            
            try:
                if 'content' in response_data and isinstance(response_data['content'], list):
                    for block in response_data['content']:
                        if block.get('type') == 'thinking':
                            thinking_content = block.get('thinking', '')
                            print(f"\n=== Thinking ë¸”ë¡ ë°œê²¬ ===")
                            print(f"Thinking ë‚´ìš© ê¸¸ì´: {len(thinking_content)}")
                        elif block.get('type') == 'text':
                            response_text = block.get('text', '')
                            print(f"\n=== Text ë¸”ë¡ ë°œê²¬ ===")
                            print(f"Text ë‚´ìš© ê¸¸ì´: {len(response_text)}")
                            break  # ì²« ë²ˆì§¸ text ë¸”ë¡ ì‚¬ìš©
                
                # text ë¸”ë¡ì´ ì—†ìœ¼ë©´ thinking ë‚´ìš©ì„ ì‚¬ìš©
                if not response_text and thinking_content:
                    print("\n=== Text ë¸”ë¡ì´ ì—†ì–´ì„œ Thinking ë‚´ìš© ì‚¬ìš© ===")
                    response_text = thinking_content
                
                if not response_text:
                    print(f"ì „ì²´ ì‘ë‹µ êµ¬ì¡°: {response_data}")
                    raise Exception("ì‘ë‹µì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
                    
            except Exception as extract_error:
                print(f"í…ìŠ¤íŠ¸ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜: {extract_error}")
                print(f"ì „ì²´ ì‘ë‹µ: {response_data}")
                raise Exception(f"ì‘ë‹µ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨: {extract_error}")
            
            # ì‘ë‹µ íŒŒì‹±
            analysis = self._parse_ai_response(response_text)
            
            # ì‘ë‹µ ì¶œë ¥ ì¶”ê°€
            print("\n=== íŒŒì‹± ì‹œì‘: ì›ë³¸ ì‘ë‹µ ===")
            print(response_text)

            # expected_minutesê°€ 10ë¶„ ë¯¸ë§Œì¸ ê²½ìš° 30ë¶„ìœ¼ë¡œ ì„¤ì •
            if analysis and analysis.get('action') in ['ENTER_LONG', 'ENTER_SHORT']:
                if analysis.get('expected_minutes', 0) < 10:
                    print("expected_minutesê°€ 10ë¶„ ë¯¸ë§Œì´ì–´ì„œ 30ë¶„ìœ¼ë¡œ ìë™ ì„¤ì •ë©ë‹ˆë‹¤.")
                    analysis['expected_minutes'] = 30
                
                # next_analysis_timeì„ í•­ìƒ expected_minutes ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì„¤ì •
                analysis['next_analysis_time'] = (datetime.now() + timedelta(minutes=analysis['expected_minutes'])).isoformat()

            # ë¶„ì„ ê²°ê³¼ê°€ Noneì¸ ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
            if analysis is None:
                print("ë¶„ì„ ê²°ê³¼ê°€ Noneì…ë‹ˆë‹¤. ê¸°ë³¸ HOLD ì•¡ì…˜ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.")
                return {
                    "action": "HOLD",
                    "position_size": 0.5,
                    "leverage": 5,
                    "expected_minutes": 15,
                    "stop_loss_roe": 5.0,
                    "take_profit_roe": 10.0,
                    "reason": "ë¶„ì„ ê²°ê³¼ê°€ ì—†ì–´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •ë¨",
                    "next_analysis_time": (datetime.now() + timedelta(minutes=60)).isoformat()
                }
                
            # HOLD ì•¡ì…˜ì¸ ê²½ìš° next_analysis_timeì„ 120ë¶„ í›„ë¡œ ì„¤ì •
            if analysis.get('action') == 'HOLD':
                analysis['next_analysis_time'] = (datetime.now() + timedelta(minutes=60)).isoformat()
                # expected_minutesê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šê±°ë‚˜ 240ìœ¼ë¡œ ê¸°ë³¸ ì„¤ì •ëœ ê²½ìš° 120ìœ¼ë¡œ ë³€ê²½
                if 'expected_minutes' not in analysis or analysis.get('expected_minutes') == 240:
                    analysis['expected_minutes'] = 120
                
            # ì´ ì†Œìš” ì‹œê°„ ê³„ì‚° ë° ë¡œê¹…
            elapsed_time = time.time() - start_time
            print(f"ë¶„ì„ ì™„ë£Œ: ì´ ì†Œìš” ì‹œê°„ {elapsed_time:.2f}ì´ˆ")

            return analysis

        except Exception as e:
            print(f"Error in Claude market analysis: {str(e)}")
            import traceback
            traceback.print_exc()
            
            # ì˜¤ë¥˜ ìœ í˜•ì— ë”°ë¥¸ ìƒì„¸ ë©”ì‹œì§€ ìƒì„±
            error_type = type(e).__name__
            error_detail = str(e)
            error_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            
            # ì˜¤ë¥˜ ìƒì„¸ ì •ë³´ ë¡œê¹…
            print(f"[{error_time}] {error_type}: {error_detail}")
            
            # ì˜ˆì™¸ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
            return {
                "action": "HOLD",
                "position_size": 0.5,
                "leverage": 5,
                "expected_minutes": 15,
                "stop_loss_roe": 5.0,
                "take_profit_roe": 10.0,
                "reason": f"ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: [{error_type}] {error_detail}",
                "next_analysis_time": (datetime.now() + timedelta(minutes=120)).isoformat(),
                "error_info": {
                    "type": error_type,
                    "message": error_detail,
                    "time": error_time
                }
            }

    def _create_analysis_prompt(self, market_data):
        """ë¶„ì„ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±"""
        # JSON ì§ë ¬í™” í—¬í¼ í•¨ìˆ˜ ì¶”ê°€
        def json_serializer(obj):
            if isinstance(obj, bool) or str(type(obj)) == "<class 'numpy.bool_'>":
                return str(obj)  # True/Falseë¥¼ "True"/"False" ë¬¸ìì—´ë¡œ ë³€í™˜
            if isinstance(obj, (datetime, date)):
                return obj.isoformat()
            if str(type(obj)).startswith("<class 'numpy"):
                return obj.item() if hasattr(obj, 'item') else str(obj)
            raise TypeError(f"Type {type(obj)} not serializable")
            
        # ìº”ë“¤ìŠ¤í‹± ìš”ì•½ (AIê°€ ì‰½ê²Œ ì½ì„ ìˆ˜ ìˆëŠ” í˜•ì‹) - í•µì‹¬ ì‹œê°„ëŒ€ë§Œ
        candle_summaries = market_data.get('candle_summaries', {})
        
        # ìš”ì•½ì´ ìˆìœ¼ë©´ ìš°ì„  í‘œì‹œ, ì—†ìœ¼ë©´ ì›ë³¸ JSON ì‚¬ìš©
        if candle_summaries:
            candlestick_summary = "\n\n".join([
                candle_summaries.get('15m', ''),
                candle_summaries.get('1H', ''),
                candle_summaries.get('4H', '')
            ])
        else:
            candlestick_summary = "ìš”ì•½ ì—†ìŒ"
        
        # ì›ë³¸ ìº”ë“¤ìŠ¤í‹± ë°ì´í„° (ëª¨ë“  ì‹œê°„ë´‰)
        candlestick_raw_data = self._format_all_candlestick_data(market_data)

        # ê¸°ìˆ ì  ì§€í‘œì—ì„œ í•µì‹¬ ì‹œê°„ëŒ€ë§Œ í¬í•¨ (12H, 1D ì œì™¸í•˜ì—¬ í† í° ì ˆì•½)
        all_timeframes = ['15m', '1H', '4H']
        
        # í•„ìš”í•œ ì§€í‘œë§Œ í•„í„°ë§ (í† í° ì ˆì•½)
        essential_indicators = [
            'rsi', 'macd', 'macd_signal', 'macd_histogram',
            'ema_21', 'ema_55', 'adx', 'atr', 'atr_percent',
            'current_volume', 'avg_volume_20', 'volume_ratio',
            'bb_upper', 'bb_middle', 'bb_lower', 'bb_width',
            'volume_profile'
        ]
        
        technical_indicators = {}
        for timeframe, indicators in market_data['technical_indicators'].items():
            if timeframe in all_timeframes:
                # í•„ìˆ˜ ì§€í‘œë§Œ í•„í„°ë§
                filtered_indicators = {}
                for key, value in indicators.items():
                    # ì§€í‘œ ì´ë¦„ì´ essential_indicatorsì— í¬í•¨ë˜ê±°ë‚˜ ì‹œì‘í•˜ëŠ” ê²½ìš°
                    if any(key.startswith(essential) or key == essential for essential in essential_indicators):
                        filtered_indicators[key] = value
                
                if filtered_indicators:  # í•„í„°ë§ëœ ê²°ê³¼ê°€ ìˆì„ ë•Œë§Œ ì¶”ê°€
                    technical_indicators[timeframe] = filtered_indicators
        
        # ê¸°ìˆ ì  ì§€í‘œ ìš”ì•½ (í•µì‹¬ ì‹œê°„ëŒ€ë§Œ)
        indicator_summaries = market_data.get('indicator_summaries', {})
        
        if indicator_summaries:
            indicator_summary = "\n\n".join([
                indicator_summaries.get('15m', ''),
                indicator_summaries.get('1H', ''),
                indicator_summaries.get('4H', '')
            ])
        else:
            indicator_summary = "ìš”ì•½ ì—†ìŒ"
        
        # ì‹œì¥ ë§¥ë½ ì •ë³´ ì¶”ì¶œ
        market_context = market_data.get('market_context', {})
        recent_price_action = market_context.get('recent_price_action', 'ì •ë³´ ì—†ìŒ')
        support_resistance_events = market_context.get('support_resistance_events', [])
        volume_context = market_context.get('volume_context', 'ì •ë³´ ì—†ìŒ')
        multi_timeframe = market_context.get('multi_timeframe_consistency', {})
        
        # ì§€ì§€/ì €í•­ ì´ë²¤íŠ¸ ë¬¸ìì—´ ìƒì„±
        sr_events_str = '\n  - '.join(support_resistance_events) if support_resistance_events else 'íŠ¹ì´ì‚¬í•­ ì—†ìŒ'
        
        # ë‹¤ì¤‘ ì‹œê°„ëŒ€ ì¼ê´€ì„± ì •ë³´
        mtf_score = multi_timeframe.get('score', 0)
        mtf_trend = multi_timeframe.get('dominant_trend', 'í˜¼ì¬')
        mtf_details = multi_timeframe.get('details', 'ì •ë³´ ì—†ìŒ')
        
        # ë¹—ê° ì„¤ì • ì •ë³´
        diagonal_settings = market_data.get('diagonal_settings', {})

        prompt = f"""### í˜„ì¬ ì‹œì¥ ìƒíƒœ:
- í˜„ì¬ê°€: {market_data['current_market']['price']} USDT
- 24ì‹œê°„ ê³ ê°€: {market_data['current_market']['24h_high']} USDT
- 24ì‹œê°„ ì €ê°€: {market_data['current_market']['24h_low']} USDT
- 24ì‹œê°„ ê±°ë˜ëŸ‰: {market_data['current_market']['24h_volume']} BTC
- 24ì‹œê°„ ë³€ë™ì„±: {round(((market_data['current_market']['24h_high'] - market_data['current_market']['24h_low']) / market_data['current_market']['24h_low']) * 100, 2)}%

### ì‹œìŠ¤í…œ ë™ì‘ì›ë¦¬:
- í•œë²ˆ í¬ì§€ì…˜ ì§„ì…í•˜ë©´ ë¶€ë¶„ ì²­ì‚°, ì¶”ê°€ ì§„ì… ë¶ˆê°€ëŠ¥
- í•œë²ˆ í¬ì§€ì…˜ ì§„ì…í•˜ë©´ ë ˆë²„ë¦¬ì§€, take_profit_roe, stop_loss_roe ë³€ê²½ ë¶ˆê°€ëŠ¥
- take_profit_roe, stop_loss_roeì— ë„ë‹¬í•˜ë©´ ìë™ ì²­ì‚°
- HOLD ì‹œ ì¼ì •ì‹œê°„ ì´í›„ ì¬ë¶„ì„, ì§„ì… ì‹œ expected_minutes í›„ ê°•ì œ ì²­ì‚°
- expected_minutes ì‹œê°„ ë™ì•ˆ í¬ì§€ì…˜ ìœ ì§€ë˜ë©´ ê°•ì œ í¬ì§€ì…˜ ì²­ì‚° í›„ ì¼ì •ì‹œê°„ ì´í›„ ì¬ë¶„ì„ ìˆ˜í–‰í•˜ì—¬ ë‹¤ì‹œ í¬ì§€ì…˜ ì§„ì… ê²°ì •
- í¬ì§€ì…˜ ì§„ì…í•˜ë©´ íŠ¹ì • ì£¼ê¸°ë¡œ ëª¨ë‹ˆí„°ë§ë¶„ì„ ìˆ˜í–‰. ëª¨ë‹ˆí„°ë§ ë¶„ì„ ê²°ê³¼ê°€ í˜„ì¬ í¬ì§€ì…˜ ë°©í–¥ê³¼ ì¼ì¹˜í•˜ë©´ ìƒˆë¡œìš´ roeê°’ìœ¼ë¡œ ìˆ˜ì •, ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ í¬ì§€ì…˜ ê°•ì œ ì²­ì‚° í›„ ëª¨ë‹ˆí„°ë§ ë¶„ì„ ê²°ê³¼ë¡œ í¬ì§€ì…˜ ì¬ì§„ì….

### ì œê³µ ë°ì´í„°:

ìº”ë“¤ìŠ¤í‹± ì›ë³¸:
{candlestick_raw_data}

ê¸°ìˆ ì  ì§€í‘œ ì›ë³¸ (15ë¶„, 1ì‹œê°„, 4ì‹œê°„ - í•µì‹¬ ì§€í‘œë§Œ):
{json.dumps(technical_indicators, default=json_serializer)}

ìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ Extended Thinkingì„ í™œìš©í•˜ì—¬ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ìˆ˜ìµì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆëŠ” ìµœì ì˜ ê±°ë˜ ê²°ì •ì„ ë‚´ë ¤ì£¼ì„¸ìš”. 

**ğŸš¨ ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤:**

**ğŸ“ ì‚¬ìš©ì ì§€ì • ë¹—ê° í¬ì¸íŠ¸ (í•„ìˆ˜):**

ì„ íƒëœ ë¹—ê° íƒ€ì…: {diagonal_settings.get('diagonal_type', 'ì„¤ì • ì•ˆ ë¨')}
- Point A ì‹œê°„: {diagonal_settings.get('point_a_time', 'ì„¤ì • ì•ˆ ë¨')}
- ë‘ ë²ˆì§¸ ì €ì /ê³ ì  ì‹œê°„: {diagonal_settings.get('point_second_time', 'ì„¤ì • ì•ˆ ë¨')}
- Point B (ë³€ê³¡ì ) ì‹œê°„: {diagonal_settings.get('point_b_time', 'ì„¤ì • ì•ˆ ë¨')}

âš ï¸ **ì¤‘ìš”**: ì‚¬ìš©ìê°€ ì§€ì •í•œ í¬ì¸íŠ¸ë§Œ ì‚¬ìš©í•˜ì—¬ ë¹—ê°ì„ ê·¸ë¦½ë‹ˆë‹¤. ìë™ íƒìƒ‰ ê¸ˆì§€!

**Step 1: ì‚¬ìš©ì ì§€ì • ë¹—ê° ë¶„ì„ (Diagonal Line Analysis) - ê°€ì¥ ì¤‘ìš”!**

**ğŸ¯ ë¶„ì„ ì§„í–‰ ê·œì¹™:**
1. diagonal_typeì´ 'uptrend'ë©´ â†’ **ìƒìŠ¹ ë¹—ê°ë§Œ** ë¶„ì„
2. diagonal_typeì´ 'downtrend'ë©´ â†’ **í•˜ë½ ë¹—ê°ë§Œ** ë¶„ì„
3. diagonal_typeì´ Noneì´ê±°ë‚˜ í¬ì¸íŠ¸ ì •ë³´ê°€ ì—†ìœ¼ë©´ â†’ **ë¹—ê° ë¶„ì„ ê±´ë„ˆë›°ê³  Step 2ë¡œ ì´ë™**

**1-A. ìƒìŠ¹ ë¹—ê° ì±„ë„ ê·¸ë¦¬ê¸° (diagonal_type = 'uptrend'ì¸ ê²½ìš°ë§Œ):**
   
   **Step 1-A-1: ì‚¬ìš©ì ì§€ì • í¬ì¸íŠ¸ë¡œ ìº”ë“¤ ì°¾ê¸°**
   - 1ì‹œê°„ë´‰ ë°ì´í„°ì—ì„œ ì‚¬ìš©ìê°€ ì§€ì •í•œ ì‹œê°„ê³¼ **ì¼ì¹˜í•˜ëŠ” ìº”ë“¤** ì°¾ê¸°
   - ì‹œê°„ í˜•ì‹: YYYY-MM-DD HH:MM (ì˜ˆ: 2025-10-11 06:00)
   - âš ï¸ ìº”ë“¤ timestampë¥¼ YYYY-MM-DD HH:MM í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
   
   **Point A (ì—­ì‚¬ì  ì €ì ):**
   - point_a_timeì— í•´ë‹¹í•˜ëŠ” ìº”ë“¤ ì°¾ê¸°
   - í•´ë‹¹ ìº”ë“¤ì˜ **low ê°’** ì‚¬ìš©
   - ë³´ê³ : Point A low ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, volume
   
   **ë‘ ë²ˆì§¸ ì €ì :**
   - point_second_timeì— í•´ë‹¹í•˜ëŠ” ìº”ë“¤ ì°¾ê¸°
   - í•´ë‹¹ ìº”ë“¤ì˜ **low ê°’** ì‚¬ìš©
   - ë³´ê³ : ë‘ ë²ˆì§¸ ì €ì  low ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, volume
   
   **Point B (ë³€ê³¡ì ):**
   - point_b_timeì— í•´ë‹¹í•˜ëŠ” ìº”ë“¤ ì°¾ê¸°
   - í•´ë‹¹ ìº”ë“¤ì˜ **low ê°’** ì‚¬ìš©
   - ë³´ê³ : Point B low ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, volume
   
   **Step 1-A-2: ë¹—ê° 1 (ì£¼ ë¹—ê°) ê·¸ë¦¬ê¸°**
   - Point Aì˜ lowì™€ Point Bì˜ lowë¥¼ ì—°ê²° â†’ **ë¹—ê° 1 (ì£¼ ìƒìŠ¹ ë¹—ê°)**
   - ê¸°ìš¸ê¸° ê³„ì‚°: slope = (Point B low - Point A low) / (Point B index - Point A index)
   - ë³´ê³ : ë¹—ê° 1ì˜ ê¸°ìš¸ê¸° ê°’ (USDT/ì‹œê°„)
   
   **Step 1-A-3: ë¹—ê° 2 (ì²« ë²ˆì§¸ í‰í–‰ ë¹—ê°) ê·¸ë¦¬ê¸°**
   - ë‘ ë²ˆì§¸ ì €ì ì˜ lowì—ì„œ ì‹œì‘í•˜ëŠ” ë¹—ê° 1ê³¼ **í‰í–‰í•œ ì§ì„ ** â†’ **ë¹—ê° 2**
   - ë¹—ê° 2ì˜ ê¸°ìš¸ê¸°ëŠ” ë¹—ê° 1ê³¼ ë™ì¼
   
   **Step 1-A-4: ì±„ë„ ê°„ê²©(D) ê³„ì‚°**
   - ë‘ ë²ˆì§¸ ì €ì  ì‹œì ì—ì„œ ë¹—ê° 1ê³¼ ë¹—ê° 2ì˜ **ìˆ˜ì§ ê±°ë¦¬(ê°€ê²© ì°¨ì´)** ê³„ì‚°
   - ë¹—ê° 1ì˜ ë‘ ë²ˆì§¸ ì €ì  ì‹œì  ê°€ê²© = Point A low + slope Ã— (ë‘ ë²ˆì§¸ ì €ì  index - Point A index)
   - ì±„ë„ ê°„ê²© D = |ë¹—ê° 1ì˜ í•´ë‹¹ ì‹œì  ê°€ê²© - ë‘ ë²ˆì§¸ ì €ì  low|
   - ë³´ê³ : ì±„ë„ ê°„ê²© D (USDT)
   
   **Step 1-A-5: ì¶”ê°€ ì±„ë„ ë¹—ê° ê·¸ë¦¬ê¸° (ë¹—ê° 3, 4, 5...)**
   - **ë¹—ê° 3**: ë¹—ê° 2ì—ì„œ ì•„ë˜ ë°©í–¥ìœ¼ë¡œ ê°„ê²© Dë§Œí¼ ë–¨ì–´ì§„ í‰í–‰ì„ 
   - **ë¹—ê° 4**: ë¹—ê° 3ì—ì„œ ì•„ë˜ ë°©í–¥ìœ¼ë¡œ ê°„ê²© Dë§Œí¼ ë–¨ì–´ì§„ í‰í–‰ì„ 
   - í•„ìš”ì‹œ ê³„ì† ì¶”ê°€
   - âš ï¸ ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì€ ì´ ë¹—ê°ë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ ì›€ì§ì´ë©°, í•œ ë¹—ê°ì„ ëš«ìœ¼ë©´ ë‹¤ìŒ ë¹—ê°ê¹Œì§€ ì´ë™í•˜ëŠ” ê²½í–¥
   - ë³´ê³ : ìƒì„±ëœ ì±„ë„ ë¹—ê° ê°œìˆ˜
   
**1-B. í•˜ë½ ë¹—ê° ì±„ë„ ê·¸ë¦¬ê¸° (diagonal_type = 'downtrend'ì¸ ê²½ìš°ë§Œ):**
   
   **Step 1-B-1: ì‚¬ìš©ì ì§€ì • í¬ì¸íŠ¸ë¡œ ìº”ë“¤ ì°¾ê¸°**
   - 1ì‹œê°„ë´‰ ë°ì´í„°ì—ì„œ ì‚¬ìš©ìê°€ ì§€ì •í•œ ì‹œê°„ê³¼ **ì¼ì¹˜í•˜ëŠ” ìº”ë“¤** ì°¾ê¸°
   - ì‹œê°„ í˜•ì‹: YYYY-MM-DD HH:MM (ì˜ˆ: 2025-10-05 13:00)
   - âš ï¸ ìº”ë“¤ timestampë¥¼ YYYY-MM-DD HH:MM í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
   
   **Point A (ì—­ì‚¬ì  ê³ ì ):**
   - point_a_timeì— í•´ë‹¹í•˜ëŠ” ìº”ë“¤ ì°¾ê¸°
   - í•´ë‹¹ ìº”ë“¤ì˜ **high ê°’** ì‚¬ìš©
   - ë³´ê³ : Point A high ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, volume
   
   **ë‘ ë²ˆì§¸ ê³ ì :**
   - point_second_timeì— í•´ë‹¹í•˜ëŠ” ìº”ë“¤ ì°¾ê¸°
   - í•´ë‹¹ ìº”ë“¤ì˜ **high ê°’** ì‚¬ìš©
   - ë³´ê³ : ë‘ ë²ˆì§¸ ê³ ì  high ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, volume
   
   **Point B (ë³€ê³¡ì ):**
   - point_b_timeì— í•´ë‹¹í•˜ëŠ” ìº”ë“¤ ì°¾ê¸°
   - í•´ë‹¹ ìº”ë“¤ì˜ **high ê°’** ì‚¬ìš©
   - ë³´ê³ : Point B high ê°€ê²©, ì‹œê°„, ìº”ë“¤ ì¸ë±ìŠ¤, volume
   
   **Step 1-B-2: ë¹—ê° 1 (ì£¼ ë¹—ê°) ê·¸ë¦¬ê¸°**
   - Point Aì˜ highì™€ Point Bì˜ highë¥¼ ì—°ê²° â†’ **ë¹—ê° 1 (ì£¼ í•˜ë½ ë¹—ê°)**
   - ê¸°ìš¸ê¸° ê³„ì‚°: slope = (Point B high - Point A high) / (Point B index - Point A index)
   - ë³´ê³ : ë¹—ê° 1ì˜ ê¸°ìš¸ê¸° ê°’ (USDT/ì‹œê°„)
   
   **Step 1-B-3: ë¹—ê° 2 (ì²« ë²ˆì§¸ í‰í–‰ ë¹—ê°) ê·¸ë¦¬ê¸°**
   - ë‘ ë²ˆì§¸ ê³ ì ì˜ highì—ì„œ ì‹œì‘í•˜ëŠ” ë¹—ê° 1ê³¼ **í‰í–‰í•œ ì§ì„ ** â†’ **ë¹—ê° 2**
   - ë¹—ê° 2ì˜ ê¸°ìš¸ê¸°ëŠ” ë¹—ê° 1ê³¼ ë™ì¼
   
   **Step 1-B-4: ì±„ë„ ê°„ê²©(D) ê³„ì‚°**
   - ë‘ ë²ˆì§¸ ê³ ì  ì‹œì ì—ì„œ ë¹—ê° 1ê³¼ ë¹—ê° 2ì˜ **ìˆ˜ì§ ê±°ë¦¬(ê°€ê²© ì°¨ì´)** ê³„ì‚°
   - ë¹—ê° 1ì˜ ë‘ ë²ˆì§¸ ê³ ì  ì‹œì  ê°€ê²© = Point A high + slope Ã— (ë‘ ë²ˆì§¸ ê³ ì  index - Point A index)
   - ì±„ë„ ê°„ê²© D = |ë¹—ê° 1ì˜ í•´ë‹¹ ì‹œì  ê°€ê²© - ë‘ ë²ˆì§¸ ê³ ì  high|
   - ë³´ê³ : ì±„ë„ ê°„ê²© D (USDT)
   
   **Step 1-B-5: ì¶”ê°€ ì±„ë„ ë¹—ê° ê·¸ë¦¬ê¸° (ë¹—ê° 3, 4, 5...)**
   - **ë¹—ê° 3**: ë¹—ê° 2ì—ì„œ ìœ„ ë°©í–¥ìœ¼ë¡œ ê°„ê²© Dë§Œí¼ ë–¨ì–´ì§„ í‰í–‰ì„ 
   - **ë¹—ê° 4**: ë¹—ê° 3ì—ì„œ ìœ„ ë°©í–¥ìœ¼ë¡œ ê°„ê²© Dë§Œí¼ ë–¨ì–´ì§„ í‰í–‰ì„ 
   - í•„ìš”ì‹œ ê³„ì† ì¶”ê°€
   - âš ï¸ ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì€ ì´ ë¹—ê°ë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ ì›€ì§ì´ë©°, í•œ ë¹—ê°ì„ ëš«ìœ¼ë©´ ë‹¤ìŒ ë¹—ê°ê¹Œì§€ ì´ë™í•˜ëŠ” ê²½í–¥
   - ë³´ê³ : ìƒì„±ëœ ì±„ë„ ë¹—ê° ê°œìˆ˜
   
**1-C. í˜„ì¬ ì‹œì ì˜ ì±„ë„ ë¹—ê° ìœ„ì¹˜ ê³„ì‚°** (ë§¤ìš° ì¤‘ìš”!):
   
   **diagonal_typeì´ 'uptrend'ì¸ ê²½ìš° - ìƒìŠ¹ ë¹—ê° ì±„ë„:**
   - ê¸°ìš¸ê¸°(slope) = (Point B low - Point A low) / (Point B index - Point A index)
   - ê²½ê³¼ ì‹œê°„ = í˜„ì¬ ìº”ë“¤ index - Point A ìº”ë“¤ index
   - **ë¹—ê° 1 í˜„ì¬ ìœ„ì¹˜** = Point A low + (slope Ã— ê²½ê³¼ ì‹œê°„)
   - **ë¹—ê° 2 í˜„ì¬ ìœ„ì¹˜** = ë¹—ê° 1 í˜„ì¬ ìœ„ì¹˜ - D
   - **ë¹—ê° 3 í˜„ì¬ ìœ„ì¹˜** = ë¹—ê° 2 í˜„ì¬ ìœ„ì¹˜ - D
   - **ë¹—ê° 4 í˜„ì¬ ìœ„ì¹˜** = ë¹—ê° 3 í˜„ì¬ ìœ„ì¹˜ - D
   - ë³´ê³ : ê° ë¹—ê°ì˜ í˜„ì¬ ìœ„ì¹˜ ê°€ê²©
   
   **diagonal_typeì´ 'downtrend'ì¸ ê²½ìš° - í•˜ë½ ë¹—ê° ì±„ë„:**
   - ê¸°ìš¸ê¸°(slope) = (Point B high - Point A high) / (Point B index - Point A index)
   - ê²½ê³¼ ì‹œê°„ = í˜„ì¬ ìº”ë“¤ index - Point A ìº”ë“¤ index
   - **ë¹—ê° 1 í˜„ì¬ ìœ„ì¹˜** = Point A high + (slope Ã— ê²½ê³¼ ì‹œê°„)
   - **ë¹—ê° 2 í˜„ì¬ ìœ„ì¹˜** = ë¹—ê° 1 í˜„ì¬ ìœ„ì¹˜ + D
   - **ë¹—ê° 3 í˜„ì¬ ìœ„ì¹˜** = ë¹—ê° 2 í˜„ì¬ ìœ„ì¹˜ + D
   - **ë¹—ê° 4 í˜„ì¬ ìœ„ì¹˜** = ë¹—ê° 3 í˜„ì¬ ìœ„ì¹˜ + D
   - ë³´ê³ : ê° ë¹—ê°ì˜ í˜„ì¬ ìœ„ì¹˜ ê°€ê²©
   
   âš ï¸ **ì£¼ì˜ì‚¬í•­**:
   - Point Bì—ì„œ ë©ˆì¶”ì§€ ì•Šê³  ì§ì„ ìœ¼ë¡œ ì—°ì¥í•´ì„œ ê³„ì‚°!
   
**1-D. í˜„ì¬ ê°€ê²©ì´ ì–´ëŠ ì±„ë„ì— ìœ„ì¹˜í•˜ëŠ”ì§€ íŒŒì•…**:
   - í˜„ì¬ ê°€ê²©ì´ ë¹—ê° 1ê³¼ 2 ì‚¬ì´? 2ì™€ 3 ì‚¬ì´? 3ê³¼ 4 ì‚¬ì´?
   - ê°€ì¥ ê°€ê¹Œìš´ ìœ„/ì•„ë˜ ë¹—ê° ì„  ì‹ë³„
   - ë³´ê³ : í˜„ì¬ ê°€ê²©ì˜ ì±„ë„ ë‚´ ìœ„ì¹˜ ("ë¹—ê° 2ì™€ 3 ì‚¬ì´, ë¹—ê° 2ì— ê°€ê¹Œì›€" ë“±)
   
**1-E. 15ë¶„ë´‰ìœ¼ë¡œ ì •ë°€ ì§„ì… íƒ€ì´ë° í¬ì°©**:
   - 1ì‹œê°„ë´‰ìœ¼ë¡œ ê³„ì‚°ëœ ì±„ë„ ë¹—ê° ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©
   - 15ë¶„ë´‰ì—ì„œ ë¹—ê°ê³¼ í˜„ì¬ ê°€ê²©ì˜ ê´€ê³„ ë¶„ì„
   - 15ë¶„ë´‰ ìº”ë“¤ì´ ë¹—ê°ì„ ëŒíŒŒ/ë¦¬í…ŒìŠ¤íŠ¸/ì§€ì§€/ì €í•­í•˜ëŠ”ì§€ í™•ì¸
   
**1-F. ë¹—ê° ì±„ë„ ê¸°ë°˜ ì§„ì… ì‹ í˜¸ (ìµœìš°ì„  íŒë‹¨ ê¸°ì¤€):**
   
   **ğŸ¯ ìƒìŠ¹ ë¹—ê° ì±„ë„ ì‹ í˜¸:**
   1. **ë¹—ê° ëŒíŒŒ í›„ ì§€ì§€ í™•ì¸ (ë¡± ì§„ì…)**
      - ê°€ê²©ì´ ìƒìŠ¹ ë¹—ê°(ì˜ˆ: ë¹—ê° 2)ì„ ìœ„ë¡œ ëŒíŒŒ
      - 15ë¶„ë´‰ì—ì„œ ë¦¬í…ŒìŠ¤íŠ¸ ì‹œ ë¹—ê°ì—ì„œ ì§€ì§€ í™•ì¸
      - SL: ë¹—ê° ì•„ë˜ (ì˜ˆ: ë¹—ê° 2 -0.5%)
      - TP: ë‹¤ìŒ ìƒìœ„ ë¹—ê° (ì˜ˆ: ë¹—ê° 1 ê·¼ì²˜)
      
   2. **ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ìˆ ì§„ì…)**
      - ê°€ê²©ì´ ìƒìŠ¹ ë¹—ê°ì„ ìœ„ë¡œ ëŒíŒŒí–ˆìœ¼ë‚˜
      - 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ë¹—ê°ì„ ë‹¤ì‹œ í•˜í–¥ ëŒíŒŒ
      - SL: ë¹—ê° ìœ„ (ì˜ˆ: ë¹—ê° 2 +0.5%)
      - TP: ë‹¤ìŒ í•˜ìœ„ ë¹—ê° (ì˜ˆ: ë¹—ê° 3 ê·¼ì²˜)
      
   3. **ë¹—ê° ì €í•­ (ìˆ ì§„ì…)**
      - ê°€ê²©ì´ ìƒìŠ¹ ë¹—ê°(ì˜ˆ: ë¹—ê° 2)ì— ê·¼ì ‘í–ˆìœ¼ë‚˜ ëš«ì§€ ëª»í•¨
      - 15ë¶„ë´‰ì—ì„œ ë°˜ë½ ì‹ í˜¸ (ìŒë´‰, ê±°ë˜ëŸ‰ ì¦ê°€)
      - SL: ë¹—ê° ìœ„ (ì˜ˆ: ë¹—ê° 2 +0.5%)
      - TP: ë‹¤ìŒ í•˜ìœ„ ë¹—ê° (ì˜ˆ: ë¹—ê° 3 ê·¼ì²˜)
      
   **ğŸ¯ í•˜ë½ ë¹—ê° ì±„ë„ ì‹ í˜¸:**
   4. **ë¹—ê° í•˜í–¥ ëŒíŒŒ í›„ ì €í•­ í™•ì¸ (ìˆ ì§„ì…)**
      - ê°€ê²©ì´ í•˜ë½ ë¹—ê°(ì˜ˆ: ë¹—ê° 2)ì„ ì•„ë˜ë¡œ ëŒíŒŒ
      - 15ë¶„ë´‰ì—ì„œ ë¦¬í…ŒìŠ¤íŠ¸ ì‹œ ë¹—ê°ì—ì„œ ì €í•­ í™•ì¸
      - SL: ë¹—ê° ìœ„ (ì˜ˆ: ë¹—ê° 2 +0.5%)
      - TP: ë‹¤ìŒ í•˜ìœ„ ë¹—ê° (ì˜ˆ: ë¹—ê° 3 ê·¼ì²˜)
      
   5. **ë¹—ê° í•˜í–¥ ëŒíŒŒ í›„ ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ë¡± ì§„ì…)**
      - ê°€ê²©ì´ í•˜ë½ ë¹—ê°ì„ ì•„ë˜ë¡œ ëŒíŒŒí–ˆìœ¼ë‚˜
      - 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ë¹—ê°ì„ ë‹¤ì‹œ ìƒí–¥ ëŒíŒŒ (í˜ì´í¬ ë¸Œë ˆì´í¬ë‹¤ìš´)
      - SL: ë¹—ê° ì•„ë˜ (ì˜ˆ: ë¹—ê° 2 -0.5%)
      - TP: ë‹¤ìŒ ìƒìœ„ ë¹—ê° (ì˜ˆ: ë¹—ê° 1 ê·¼ì²˜)
      
   6. **ë¹—ê° ì§€ì§€ (ë¡± ì§„ì…)**
      - ê°€ê²©ì´ í•˜ë½ ë¹—ê°(ì˜ˆ: ë¹—ê° 2)ì— ê·¼ì ‘í–ˆìœ¼ë‚˜ ëš«ì§€ ëª»í•¨
      - 15ë¶„ë´‰ì—ì„œ ë°˜ë“± ì‹ í˜¸ (ì–‘ë´‰, ê±°ë˜ëŸ‰ ì¦ê°€)
      - SL: ë¹—ê° ì•„ë˜ (ì˜ˆ: ë¹—ê° 2 -0.5%)
      - TP: ë‹¤ìŒ ìƒìœ„ ë¹—ê° (ì˜ˆ: ë¹—ê° 1 ê·¼ì²˜)
   
   **ğŸ¯ ì¶”ê°€ ê³ ê¸‰ ì‹œë‚˜ë¦¬ì˜¤ (ë†’ì€ ì‹ ë¢°ë„):**
   7. **ì±„ë„ ì••ì¶• ëŒíŒŒ (ë¡±/ìˆ ì§„ì…) - ì‹ ë¢°ë„ 75-85%**
      - ê°€ê²©ì´ ì¢ì€ ì±„ë„ êµ¬ê°„(ì˜ˆ: ë¹—ê° 2ì™€ 3 ì‚¬ì´)ì— **ê°‡íŒ ìƒíƒœ**
      - ìµœê·¼ 1ì‹œê°„ë´‰ **4~6ê°œ**ê°€ ì±„ë„ ë‚´ ë³€ë™í­ < 1% ë²”ìœ„
      - ê±°ë˜ëŸ‰ ê°ì†Œ â†’ ì—ë„ˆì§€ ì¶•ì 
      - 15ë¶„ë´‰ì—ì„œ ê±°ë˜ëŸ‰ í‰ê·  ëŒ€ë¹„ **2ë°° ì´ìƒ**ê³¼ í•¨ê»˜ ë¹—ê° ëŒíŒŒ
      - ëŒíŒŒ ë°©í–¥ìœ¼ë¡œ ì§„ì… (ìœ„ë¡œ ëŒíŒŒ â†’ ë¡±, ì•„ë˜ë¡œ ëŒíŒŒ â†’ ìˆ)
      - SL: ë°˜ëŒ€í¸ ë¹—ê° (ì••ì¶• êµ¬ê°„ ê²½ê³„)
      - TP: ëŒíŒŒí•œ ë°©í–¥ì˜ ë‹¤ìŒ ë¹—ê°
      - âš ï¸ **ì••ì¶•-í­ë°œ íŒ¨í„´**ì€ ê°•í•œ ì¶”ì„¸ í˜•ì„±, ëª©í‘œê°€ ë¹ ë¥¸ ë„ë‹¬
      
   8. **ë‹¤ì¤‘ ë¹—ê° ë™ì‹œ ëŒíŒŒ (ë¡±/ìˆ ì§„ì…) - ì‹ ë¢°ë„ 80-90%**
      - í•œ ë²ˆì— **2ê°œ ì´ìƒì˜ ë¹—ê°**ì„ ë™ì‹œì— í†µê³¼
      - ì˜ˆ: ë¹—ê° 3 â†’ ë¹—ê° 2ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  â†’ ë¹—ê° 1ê¹Œì§€ ì§í–‰
      - 1ì‹œê°„ë´‰ 1~2ê°œ ë‚´ì— 2ê°œ ë¹—ê° í†µê³¼
      - ê±°ë˜ëŸ‰ í‰ê·  ëŒ€ë¹„ **2.5ë°° ì´ìƒ** (ì´ˆê°•ë ¥ ëª¨ë©˜í…€)
      - 15ë¶„ë´‰ì—ì„œ ì²« ë²ˆì§¸ í†µê³¼í•œ ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹œ ì§„ì…
      - SL: ì²« ë²ˆì§¸ í†µê³¼í•œ ë¹—ê° (ì˜ˆ: ë¹—ê° 2) ë°˜ëŒ€í¸ 0.5%
      - TP: ë‹¤ìŒ ë¹—ê° (ì˜ˆ: ë¹—ê° 0 ë˜ëŠ” ë¹—ê° 4)
      - âš ï¸ **ëŒ€í˜• ìë³¸ì˜ ê¸‰ê²©í•œ ì›€ì§ì„** ì‹ í˜¸, ì„±ê³µë¥  ìµœê³ 
      
   9. **ë”ë¸” í„°ì¹˜ (ë¡±/ìˆ ì§„ì…) - ì‹ ë¢°ë„ 70-75%**
      - ë™ì¼í•œ ë¹—ê°ì„ ì§§ì€ ì‹œê°„(3~6ì‹œê°„) ë‚´ì— **2ë²ˆ ì—°ì† í„°ì¹˜**
      - ì²« ë²ˆì§¸ í„°ì¹˜ì—ì„œ ë°˜ë“±/ë°˜ë½ í™•ì¸
      - ë‘ ë²ˆì§¸ í„°ì¹˜ì—ì„œ **ë” ê°•í•œ ë°˜ì‘** (ê±°ë˜ëŸ‰ ì¦ê°€)
      - ìƒìŠ¹ ë¹—ê° 2ë²ˆ í„°ì¹˜ í›„ ê°•í•œ ì–‘ë´‰ â†’ ë¡± ì§„ì…
      - í•˜ë½ ë¹—ê° 2ë²ˆ í„°ì¹˜ í›„ ê°•í•œ ìŒë´‰ â†’ ìˆ ì§„ì…
      - SL: ë¹—ê° ë°˜ëŒ€í¸ 0.5%
      - TP: ë‹¤ìŒ ë¹—ê°
      - âš ï¸ **ì‹ ë¢°ë„ ê²€ì¦ ì™„ë£Œ**ëœ ë¹—ê°, ì‹œì¥ì˜ ê°•í•œ ì§€ì§€/ì €í•­ ì¸ì‹
   
   **ğŸ¯ ì±„ë„ ê°„ ì´ë™ ì›ë¦¬:**
   - í•œ ë¹—ê°ì„ ëª…í™•íˆ ëŒíŒŒí•˜ë©´ ë‹¤ìŒ ë¹—ê°ê¹Œì§€ ì›€ì§ì´ëŠ” ê²½í–¥
   - ì˜ˆ: ë¹—ê° 2 ëŒíŒŒ â†’ ë¹—ê° 1ë¡œ ì´ë™ ë˜ëŠ” ë¹—ê° 3ìœ¼ë¡œ ì´ë™
   - ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìœ¼ë©´ ì¶”ì„¸ ì¶”ì¢…ìœ¼ë¡œ ì§„ì… (ìœ„ì¹˜ ë¬´ê´€)
   - ì••ì¶• êµ¬ê°„ì€ ì˜ˆì™¸: ì—ë„ˆì§€ ì¶•ì  í›„ í­ë°œ ê°€ëŠ¥ì„±

**1-G. ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ë¯¸ì¶©ì¡± ì‹œ ì¶”ì„¸ ì¶”ì¢… ì§„ì… (ì¶”ê°€ ì‹œë‚˜ë¦¬ì˜¤)**

âš ï¸ **ìš°ì„ ìˆœìœ„**: ìœ„ 9ê°€ì§€ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ê°€ **ìµœìš°ì„ **ì…ë‹ˆë‹¤. 9ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ì— í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ (í˜„ì¬ê°€ê°€ ë¹—ê° ê·¼ì²˜ë“  ì¤‘ê°„ì´ë“  ê´€ê³„ì—†ì´) ì•„ë˜ ì¶”ì„¸ ì¶”ì¢… ë¡œì§ì„ ì ìš©í•©ë‹ˆë‹¤.

**ì§„ì… ì¡°ê±´ (ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ì„ ë•Œë§Œ):**
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ) ì¤‘ ì–´ëŠ ê²ƒë„ ì¶©ì¡±í•˜ì§€ ì•ŠìŒ
- ë¡±/ìˆ ê° ë°©í–¥ë³„ 5ê°€ì§€ ì¡°ê±´ì„ í‰ê°€
- ê° ë°©í–¥ë³„ ìµœì†Œ 2ê°œ ì´ìƒ ì¶©ì¡± ì‹œ ì§„ì… ê³ ë ¤
- **ë” ë§ì€ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„ì…**

**ğŸ”º ë¡± í¬ì§€ì…˜ ì§„ì… ì¡°ê±´ (5ê°€ì§€ ì¤‘ ìµœì†Œ 2ê°œ ì´ìƒ ë™ì‹œ ì¶©ì¡± ì‹œ ê³ ë ¤):**
1. **ì¶”ì„¸ í™•ì¸**: 15ë¶„ ì°¨íŠ¸ì—ì„œ 21EMA > 55EMA ë°°ì—´ì´ê³  ê°€ê²©ì´ 21EMA ìœ„ì— ìœ„ì¹˜
2. **ëª¨ë©˜í…€ í™•ì¸**: 15ë¶„ RSIê°€ 50 ì´ìƒì´ê³  ìƒìŠ¹ ì¶”ì„¸ (ìµœê·¼ 3ë´‰ ê¸°ì¤€)
3. **ë³¼ë¥¨ í™•ì¸**: í˜„ì¬ ë³¼ë¥¨ì´ ìµœê·¼ 20ë´‰ í‰ê·  ë³¼ë¥¨ì˜ 1.2ë°° ì´ìƒ
4. **ì§€ì§€ì„  í™•ì¸**: ì£¼ìš” ì§€ì§€ì„ (ë³¼ë¥¨ í”„ë¡œíŒŒì¼ POC/VAL) ê·¼ì²˜ì—ì„œ ë°˜ë“± ì‹ í˜¸
5. **MACD í™•ì¸**: 15ë¶„ MACDê°€ ì‹œê·¸ë„ì„  ìœ„ì— ìˆê³  íˆìŠ¤í† ê·¸ë¨ì´ ì¦ê°€ ì¤‘

**ğŸ”» ìˆ í¬ì§€ì…˜ ì§„ì… ì¡°ê±´ (5ê°€ì§€ ì¤‘ ìµœì†Œ 2ê°œ ì´ìƒ ë™ì‹œ ì¶©ì¡± ì‹œ ê³ ë ¤):**
1. **ì¶”ì„¸ í™•ì¸**: 15ë¶„ ì°¨íŠ¸ì—ì„œ 21EMA < 55EMA ë°°ì—´ì´ê³  ê°€ê²©ì´ 21EMA ì•„ë˜ì— ìœ„ì¹˜
2. **ëª¨ë©˜í…€ í™•ì¸**: 15ë¶„ RSIê°€ 50 ì´í•˜ì´ê³  í•˜ë½ ì¶”ì„¸ (ìµœê·¼ 3ë´‰ ê¸°ì¤€)
3. **ë³¼ë¥¨ í™•ì¸**: í˜„ì¬ ë³¼ë¥¨ì´ ìµœê·¼ 20ë´‰ í‰ê·  ë³¼ë¥¨ì˜ 1.2ë°° ì´ìƒ
4. **ì €í•­ì„  í™•ì¸**: ì£¼ìš” ì €í•­ì„ (ë³¼ë¥¨ í”„ë¡œíŒŒì¼ POC/VAH) ê·¼ì²˜ì—ì„œ ë°˜ë½ ì‹ í˜¸
5. **MACD í™•ì¸**: 15ë¶„ MACDê°€ ì‹œê·¸ë„ì„  ì•„ë˜ì— ìˆê³  íˆìŠ¤í† ê·¸ë¨ì´ ê°ì†Œ ì¤‘

**ì§„ì… ë°©í–¥ ê²°ì • ë¡œì§:**
- ë¡± ì¡°ê±´ 3ê°œ ì¶©ì¡±, ìˆ ì¡°ê±´ 2ê°œ ì¶©ì¡± â†’ **ë¡± ì§„ì…**
- ë¡± ì¡°ê±´ 2ê°œ ì¶©ì¡±, ìˆ ì¡°ê±´ 4ê°œ ì¶©ì¡± â†’ **ìˆ ì§„ì…**
- ë¡± ì¡°ê±´ 2ê°œ ì¶©ì¡±, ìˆ ì¡°ê±´ 2ê°œ ì¶©ì¡± â†’ **HOLD** (ëª…í™•í•œ ë°©í–¥ì„± ì—†ìŒ)
- ì–‘ ë°©í–¥ ëª¨ë‘ 2ê°œ ë¯¸ë§Œ ì¶©ì¡± â†’ **HOLD**

**SL ë° TP ì„¤ì • (ì¤‘ìš”! - ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ ìœ ì§€):**

**ê¸°ë³¸ ì›ì¹™:**
- **ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨**: ìµœì†Œ 1:2 (SL 1%ë©´ TP 2%), ì´ìƒì ìœ¼ë¡œëŠ” 1:3 (SL 0.5%ë©´ TP 1.5%)
- SL ì°¸ê³  ë¹—ê°: ì§„ì… ë°©í–¥ ë°˜ëŒ€í¸ ë¹—ê° (ë¡±ì´ë©´ í•˜ë‹¨, ìˆì´ë©´ ìƒë‹¨)
- TP ì°¸ê³  ë¹—ê°: ì§„ì… ë°©í–¥ ìª½ ë¹—ê° (ë¡±ì´ë©´ ìƒë‹¨, ìˆì´ë©´ í•˜ë‹¨)

**SL/TP ê³„ì‚° ë¡œì§ (ê°œì„ ëœ ë°©ì‹):**

**ë¡± ì§„ì… ì‹œ:**
1. **TP ì°¸ê³  ë¹—ê°(ìƒë‹¨)ê¹Œì§€ ê±°ë¦¬ ê³„ì‚°**: 
   - TP_distance_pct = (TP ë¹—ê° ê°€ê²© - í˜„ì¬ê°€) / í˜„ì¬ê°€ Ã— 100
   
2. **SL ì°¸ê³  ë¹—ê°(í•˜ë‹¨)ê¹Œì§€ ê±°ë¦¬ ê³„ì‚°**:
   - SL_distance_pct = (í˜„ì¬ê°€ - SL ë¹—ê° ê°€ê²©) / í˜„ì¬ê°€ Ã— 100
   
3. **SL/TP ì„¤ì • ê·œì¹™**:
   - **ì¼€ì´ìŠ¤ A**: TP ê±°ë¦¬ê°€ SL ê±°ë¦¬ë³´ë‹¤ 2ë°° ì´ìƒ (ì •ìƒì ì¸ ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ)
     - SL = SL ë¹—ê° ê°€ê²© (ë˜ëŠ” -0.5% ì¶”ê°€ ë²„í¼)
     - TP = TP ë¹—ê° ê°€ê²© (ë˜ëŠ” -0.3% ë²„í¼)
     
   - **ì¼€ì´ìŠ¤ B**: TP ê±°ë¦¬ê°€ SL ê±°ë¦¬ë³´ë‹¤ ì‘ìŒ (í˜„ì¬ê°€ê°€ ìƒë‹¨ ë¹—ê°ì— ë§¤ìš° ê°€ê¹Œì›€)
     - **ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ 1:3 ë¹„ìœ¨ ì ìš©**
     - TP = min(TP ë¹—ê° ê±°ë¦¬, SL ê±°ë¦¬ Ã— 3)
     - SL = TP / 3
     - ì˜ˆ: TP ë¹—ê°ì´ 1.66% ìœ„ì— ìˆê³  SL ë¹—ê°ì´ 3% ì•„ë˜ â†’ TP = 1.5%, SL = 0.5%
     
   - **ì¼€ì´ìŠ¤ C**: ë‘ ë¹—ê° ëª¨ë‘ ë„ˆë¬´ ë©€ê±°ë‚˜ ê°€ê¹Œì›€
     - **ë³´ìˆ˜ì  ë¹„ìœ¨ ì‚¬ìš©**: TP = 1.5%, SL = 0.5% (1:3 ë¹„ìœ¨)
     - ë˜ëŠ” TP = 2.0%, SL = 0.67% (1:3 ë¹„ìœ¨)

**ìˆ ì§„ì… ì‹œ:**
1. **TP ì°¸ê³  ë¹—ê°(í•˜ë‹¨)ê¹Œì§€ ê±°ë¦¬ ê³„ì‚°**:
   - TP_distance_pct = (í˜„ì¬ê°€ - TP ë¹—ê° ê°€ê²©) / í˜„ì¬ê°€ Ã— 100
   
2. **SL ì°¸ê³  ë¹—ê°(ìƒë‹¨)ê¹Œì§€ ê±°ë¦¬ ê³„ì‚°**:
   - SL_distance_pct = (SL ë¹—ê° ê°€ê²© - í˜„ì¬ê°€) / í˜„ì¬ê°€ Ã— 100
   
3. **SL/TP ì„¤ì • ê·œì¹™**:
   - **ì¼€ì´ìŠ¤ A**: TP ê±°ë¦¬ê°€ SL ê±°ë¦¬ë³´ë‹¤ 2ë°° ì´ìƒ (ì •ìƒì ì¸ ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ)
     - SL = SL ë¹—ê° ê°€ê²© (ë˜ëŠ” +0.5% ì¶”ê°€ ë²„í¼)
     - TP = TP ë¹—ê° ê°€ê²© (ë˜ëŠ” +0.3% ë²„í¼)
     
   - **ì¼€ì´ìŠ¤ B**: TP ê±°ë¦¬ê°€ SL ê±°ë¦¬ë³´ë‹¤ ì‘ìŒ (í˜„ì¬ê°€ê°€ í•˜ë‹¨ ë¹—ê°ì— ë§¤ìš° ê°€ê¹Œì›€)
     - **ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ 1:3 ë¹„ìœ¨ ì ìš©**
     - TP = min(TP ë¹—ê° ê±°ë¦¬, SL ê±°ë¦¬ Ã— 3)
     - SL = TP / 3
     - ì˜ˆ: TP ë¹—ê°ì´ 1.66% ì•„ë˜ì— ìˆê³  SL ë¹—ê°ì´ 3% ìœ„ â†’ TP = 1.5%, SL = 0.5%
     
   - **ì¼€ì´ìŠ¤ C**: ë‘ ë¹—ê° ëª¨ë‘ ë„ˆë¬´ ë©€ê±°ë‚˜ ê°€ê¹Œì›€
     - **ë³´ìˆ˜ì  ë¹„ìœ¨ ì‚¬ìš©**: TP = 1.5%, SL = 0.5% (1:3 ë¹„ìœ¨)
     - ë˜ëŠ” TP = 2.0%, SL = 0.67% (1:3 ë¹„ìœ¨)

**ì˜ˆì‹œ 1 (ë¡±, ë¹—ê° ê·¼ì²˜ - ìƒë‹¨ ë¹—ê°ì— ê°€ê¹Œì›€):**
- í˜„ì¬ê°€: $110,000
- ë¹—ê° 2 (ìƒë‹¨): $111,826 (TP ì°¸ê³ ìš©, ê±°ë¦¬ +1.66%)
- ë¹—ê° 3 (í•˜ë‹¨): $107,000 (SL ì°¸ê³ ìš©, ê±°ë¦¬ -2.73%)
- TP ê±°ë¦¬(1.66%) < SL ê±°ë¦¬(2.73%)ì˜ 2ë°° â†’ **ì¼€ì´ìŠ¤ B ì ìš©**
- **ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ 1:3 ë¹„ìœ¨ ì ìš©**:
  - TP = 1.5% (ëª©í‘œ: $111,650)
  - SL = 0.5% (ì†ì ˆ: $109,450)

**ì˜ˆì‹œ 2 (ë¡±, ì±„ë„ ì¤‘ê°„ - ì •ìƒì ì¸ ìœ„ì¹˜):**
- í˜„ì¬ê°€: $110,000 (ë¹—ê° 2ì™€ 3 ì‚¬ì´ ì¤‘ê°„)
- ë¹—ê° 2 (ìƒë‹¨): $113,000 (TP ì°¸ê³ ìš©, ê±°ë¦¬ +2.73%)
- ë¹—ê° 3 (í•˜ë‹¨): $108,500 (SL ì°¸ê³ ìš©, ê±°ë¦¬ -1.36%)
- TP ê±°ë¦¬(2.73%) > SL ê±°ë¦¬(1.36%)ì˜ 2ë°° â†’ **ì¼€ì´ìŠ¤ A ì ìš©**
- SL = $108,500 (-1.36%)
- TP = $113,000 (+2.73%)

**ì˜ˆì‹œ 3 (ìˆ, ë¹—ê° ê·¼ì²˜ - í•˜ë‹¨ ë¹—ê°ì— ê°€ê¹Œì›€):**
- í˜„ì¬ê°€: $110,000
- ë¹—ê° 2 (í•˜ë‹¨): $108,174 (TP ì°¸ê³ ìš©, ê±°ë¦¬ -1.66%)
- ë¹—ê° 3 (ìƒë‹¨): $113,000 (SL ì°¸ê³ ìš©, ê±°ë¦¬ +2.73%)
- TP ê±°ë¦¬(1.66%) < SL ê±°ë¦¬(2.73%)ì˜ 2ë°° â†’ **ì¼€ì´ìŠ¤ B ì ìš©**
- **ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ 1:3 ë¹„ìœ¨ ì ìš©**:
  - TP = 1.5% (ëª©í‘œ: $108,350)
  - SL = 0.5% (ì†ì ˆ: $110,550)

âš ï¸ **ì£¼ì˜ì‚¬í•­:**
- ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ)ê°€ ì—†ì„ ë•Œë§Œ ì‚¬ìš©
- ì¶”ì„¸ê°€ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ HOLD
- ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ì´ 1:2 ë¯¸ë§Œì´ë©´ ì§„ì…í•˜ì§€ ì•ŠìŒ

**Step 2: ì¶”ì„¸ ë¶„ì„ (15ë¶„/1ì‹œê°„ ì°¨íŠ¸ ì¤‘ì‹¬)**
1. **15ë¶„ ì°¨íŠ¸ ì¶”ì„¸** (60% ê°€ì¤‘ì¹˜):
   - 21EMAì™€ 55EMA ë°°ì—´ í™•ì¸
   - ê°€ê²©ì´ 21EMA ìœ„(ë¡±)/ì•„ë˜(ìˆ) ìœ„ì¹˜ í™•ì¸
   
2. **1ì‹œê°„ ì°¨íŠ¸ ì¶”ì„¸** (25% ê°€ì¤‘ì¹˜):
   - 15ë¶„ ì¶”ì„¸ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
   - ì¼ì¹˜í•˜ë©´ ì‹ ë¢°ë„ ìƒìŠ¹, ë¶ˆì¼ì¹˜í•˜ë©´ ì‹ ì¤‘
   
3. **ADXë¡œ ì¶”ì„¸ ê°•ë„ í™•ì¸**:
   - 15ë¶„ ADX > 20 ì´ìƒì´ë©´ ì¶”ì„¸ ì¡´ì¬ íŒë‹¨

**Step 3: ì§„ì… ì¡°ê±´ ì²´í¬**

**ğŸš¨ ìµœìš°ì„  ì¡°ê±´: ë¹—ê° ì±„ë„ ì‹œë‚˜ë¦¬ì˜¤ (5ê°€ì§€ ì¤‘ 1ê°œ ì´ìƒ ì¶©ì¡± ì‹œ ì§„ì… ê³ ë ¤)**

í˜„ì¬ ê°€ê²©ì´ ì–´ëŠ ì±„ë„ ë¹—ê° ê·¼ì²˜ì— ìˆëŠ”ì§€ í™•ì¸ í›„ í•´ë‹¹ ë¹—ê°ì„ ê¸°ì¤€ìœ¼ë¡œ ì§„ì… íŒë‹¨:

**1. ìƒìŠ¹ ë¹—ê° ëŒíŒŒ í›„ ì§€ì§€ (ë¡± ì§„ì…)**
   - ì¡°ê±´: ê°€ê²©ì´ íŠ¹ì • ìƒìŠ¹ ë¹—ê°(ì˜ˆ: ë¹—ê° 2)ì„ ìœ„ë¡œ ëŒíŒŒ â†’ 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ì§€ì§€ í™•ì¸
   - SL: í•´ë‹¹ ë¹—ê° ì•„ë˜ (ì˜ˆ: ë¹—ê° 2 -0.5%)
   - TP: ë‹¤ìŒ ìƒìœ„ ë¹—ê° ê·¼ì²˜ (ì˜ˆ: ë¹—ê° 1)
   - ì±„ë„ ì´ë™: ë¹—ê° 2 â†’ ë¹—ê° 1 ë°©í–¥

**2. ìƒìŠ¹ ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ìˆ ì§„ì…)**
   - ì¡°ê±´: ê°€ê²©ì´ ìƒìŠ¹ ë¹—ê°ì„ ìœ„ë¡œ ëŒíŒŒí–ˆìœ¼ë‚˜ â†’ 15ë¶„ë´‰ ë¦¬í…ŒìŠ¤íŠ¸ì—ì„œ ë‹¤ì‹œ í•˜í–¥ ëŒíŒŒ
   - SL: í•´ë‹¹ ë¹—ê° ìœ„ (ì˜ˆ: ë¹—ê° 2 +0.5%)
   - TP: ë‹¤ìŒ í•˜ìœ„ ë¹—ê° ê·¼ì²˜ (ì˜ˆ: ë¹—ê° 3)
   - ì±„ë„ ì´ë™: ë¹—ê° 2 â†’ ë¹—ê° 3 ë°©í–¥

**3. ìƒìŠ¹ ë¹—ê° ì €í•­ (ìˆ ì§„ì…)**
   - ì¡°ê±´: ê°€ê²©ì´ ìƒìŠ¹ ë¹—ê°ì— ê·¼ì ‘í–ˆìœ¼ë‚˜ ëš«ì§€ ëª»í•˜ê³  â†’ 15ë¶„ë´‰ ë°˜ë½ ì‹ í˜¸
   - SL: í•´ë‹¹ ë¹—ê° ìœ„ (ì˜ˆ: ë¹—ê° 2 +0.5%)
   - TP: ë‹¤ìŒ í•˜ìœ„ ë¹—ê° ê·¼ì²˜ (ì˜ˆ: ë¹—ê° 3)
   - ì±„ë„ ì´ë™: ë¹—ê° 2ì—ì„œ ë°˜ë½ â†’ ë¹—ê° 3 ë°©í–¥

**4. í•˜ë½ ë¹—ê° í•˜í–¥ ëŒíŒŒ (ìˆ ì§„ì…)**
   - ì¡°ê±´: ê°€ê²©ì´ í•˜ë½ ë¹—ê°(ì˜ˆ: ë¹—ê° 2)ì„ ì•„ë˜ë¡œ ëŒíŒŒ â†’ ì§€ì† í•˜ë½
   - SL: í•´ë‹¹ ë¹—ê° ìœ„ (ì˜ˆ: ë¹—ê° 2 +0.5%)
   - TP: ë‹¤ìŒ í•˜ìœ„ ë¹—ê° ê·¼ì²˜ (ì˜ˆ: ë¹—ê° 3)
   - ì±„ë„ ì´ë™: ë¹—ê° 2 â†’ ë¹—ê° 3 ë°©í–¥

**5. í•˜ë½ ë¹—ê° ì§€ì§€ (ë¡± ì§„ì…)**
   - ì¡°ê±´: ê°€ê²©ì´ í•˜ë½ ë¹—ê°ì— ë‹¿ì•˜ìœ¼ë‚˜ ëš«ì§€ ëª»í•˜ê³  â†’ 15ë¶„ë´‰ ë°˜ë“± ì‹ í˜¸
   - SL: í•´ë‹¹ ë¹—ê° ì•„ë˜ (ì˜ˆ: ë¹—ê° 2 -0.5%)
   - TP: ë‹¤ìŒ ìƒìœ„ ë¹—ê° ê·¼ì²˜ (ì˜ˆ: ë¹—ê° 1)
   - ì±„ë„ ì´ë™: ë¹—ê° 2ì—ì„œ ë°˜ë“± â†’ ë¹—ê° 1 ë°©í–¥

**âš ï¸ ì§„ì… íŒë‹¨ ì£¼ì˜ì‚¬í•­:**
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ) ì¤‘ í•˜ë‚˜ë¼ë„ ì¶©ì¡±ë˜ë©´ â†’ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì§„ì…
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìœ¼ë©´ â†’ ì¶”ì„¸ ì¶”ì¢…(Step 1-G)ìœ¼ë¡œ ì§„ì… ê³ ë ¤
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ì™€ ì¶”ì„¸ ì¶”ì¢… ëª¨ë‘ ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ â†’ HOLD

**ë³´ì¡° í™•ì¸ ì¡°ê±´ (ë¹—ê° ì±„ë„ ì‹œë‚˜ë¦¬ì˜¤ì™€ í•¨ê»˜ í™•ì¸í•˜ì—¬ ì§„ì… ì‹ ë¢°ë„ í–¥ìƒ):**

**ë¡± ë°©í–¥ ë³´ì¡° ì¡°ê±´:**
âœ“ 15ë¶„ ì°¨íŠ¸ì—ì„œ 21EMA > 55EMA, ê°€ê²©ì´ 21EMA ìœ„
âœ“ 15ë¶„ RSI â‰¥ 50, ìµœê·¼ 3ë´‰ ê¸°ì¤€ ìƒìŠ¹ ì¶”ì„¸
âœ“ í˜„ì¬ ë³¼ë¥¨ â‰¥ ìµœê·¼ 20ë´‰ í‰ê·  Ã— 1.2ë°°
âœ“ ì£¼ìš” ì§€ì§€ì„  ê·¼ì²˜ì—ì„œ ë°˜ë“± ì‹ í˜¸
âœ“ 15ë¶„ MACD > ì‹œê·¸ë„ì„ , íˆìŠ¤í† ê·¸ë¨ ì¦ê°€ ì¤‘

**ìˆ ë°©í–¥ ë³´ì¡° ì¡°ê±´:**
âœ“ 15ë¶„ ì°¨íŠ¸ì—ì„œ 21EMA < 55EMA, ê°€ê²©ì´ 21EMA ì•„ë˜
âœ“ 15ë¶„ RSI â‰¤ 50, ìµœê·¼ 3ë´‰ ê¸°ì¤€ í•˜ë½ ì¶”ì„¸
âœ“ í˜„ì¬ ë³¼ë¥¨ â‰¥ ìµœê·¼ 20ë´‰ í‰ê·  Ã— 1.2ë°°
âœ“ ì£¼ìš” ì €í•­ì„  ê·¼ì²˜ì—ì„œ ë°˜ë½ ì‹ í˜¸
âœ“ 15ë¶„ MACD < ì‹œê·¸ë„ì„ , íˆìŠ¤í† ê·¸ë¨ ê°ì†Œ ì¤‘

â†’ **ì§„ì… íŒë‹¨ ê¸°ì¤€ (ìš°ì„ ìˆœìœ„ë³„):**

**ğŸ¥‡ ìµœìš°ì„ : ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ (1~9ë²ˆ)**
â†’ ë¹—ê° ì±„ë„ ì‹œë‚˜ë¦¬ì˜¤ 1ê°œ ì¶©ì¡± + ë³´ì¡° ì¡°ê±´ 1ê°œ ì´ìƒ ì¶©ì¡± â†’ **ì¦‰ì‹œ ì§„ì…**
â†’ ë¹—ê° ì±„ë„ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—¬ëŸ¬ ê°œ ë™ì‹œ ì‹ í˜¸ â†’ ë” ê°•í•œ ì‹ í˜¸ (ìœ íš¨ì„±, ë³´ì¡°ì¡°ê±´ ì¶©ì¡±ë„ ë†’ì€) ì„ íƒ
â†’ ë¹—ê° ìœ íš¨ì„± ê²€ì¦(ì‹œê°„ ê°„ê²©, ìµœì‹ ì„±, í„°ì¹˜ íšŸìˆ˜) í†µê³¼ ì‹œ ì‹ ë¢°ë„ ì¦ê°€
â†’ ADX â‰¥ 20ì´ë©´ ì‹ ë¢°ë„ ì¦ê°€, ë‹¤ì¤‘ ì‹œê°„ëŒ€ ì¼ê´€ì„± â‰¥ 60ì ì´ë©´ ë”ìš± ìœ ë¦¬

**ğŸ¥ˆ ì°¨ì„ : ì¶”ì„¸ ì¶”ì¢… ì§„ì… (ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ë¯¸ì¶©ì¡± ì‹œ)**
â†’ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ) **ì—†ì„ ë•Œë§Œ** ì ìš©
â†’ ë¡± ì¡°ê±´ 5ê°œ ì¤‘ 2ê°œ ì´ìƒ ì¶©ì¡± ë˜ëŠ” ìˆ ì¡°ê±´ 5ê°œ ì¤‘ 2ê°œ ì´ìƒ ì¶©ì¡± í™•ì¸
â†’ **ë” ë§ì€ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„ì…**
â†’ ì˜ˆ: ë¡± ì¡°ê±´ 3ê°œ, ìˆ ì¡°ê±´ 2ê°œ â†’ ë¡± ì§„ì…
â†’ SL/TPëŠ” ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨(1:2 ë˜ëŠ” 1:3) ìœ ì§€ (Step 1-G ì°¸ê³ )
â†’ ë¹—ê°ê¹Œì§€ ê±°ë¦¬ë¥¼ ê³ ë ¤í•˜ì—¬ SL/TP ì„¤ì • (ì˜ˆ: TP ë¹—ê° 1.66%ë©´ TP=1.5%, SL=0.5%)
â†’ ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ì´ 1:2 ë¯¸ë§Œì´ë©´ ì§„ì…í•˜ì§€ ì•ŠìŒ

**ğŸ¥‰ í™€ë“œ: ì¡°ê±´ ë¯¸ì¶©ì¡±**
â†’ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  + ì–‘ ë°©í–¥ ëª¨ë‘ ì¡°ê±´ 2ê°œ ë¯¸ë§Œ â†’ **HOLD**
â†’ ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  + ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:2 ë¯¸ë§Œ â†’ **HOLD**

â†’ **ê³ ê¸‰ ì‹œë‚˜ë¦¬ì˜¤ íŠ¹ë³„ ê³ ë ¤ì‚¬í•­:**
â†’ **ì‹œë‚˜ë¦¬ì˜¤ 7 (ì±„ë„ ì••ì¶•)**: ì±„ë„ ì¤‘ê°„ì—ì„œë„ ì§„ì… ê°€ëŠ¥, ê±°ë˜ëŸ‰ 2ë°° ì´ìƒ í•„ìˆ˜
â†’ **ì‹œë‚˜ë¦¬ì˜¤ 8 (ë‹¤ì¤‘ ë¹—ê° ëŒíŒŒ)**: ê°€ì¥ ë†’ì€ ì‹ ë¢°ë„(80-90%), ê±°ë˜ëŸ‰ 2.5ë°° ì´ìƒ í•„ìˆ˜, ë¦¬í…ŒìŠ¤íŠ¸ ë†“ì¹˜ì§€ ì•Šë„ë¡ ì£¼ì˜
â†’ **ì‹œë‚˜ë¦¬ì˜¤ 9 (ë”ë¸” í„°ì¹˜)**: 3~6ì‹œê°„ ë‚´ 2ë²ˆì§¸ í„°ì¹˜ í™•ì¸, ì²« ë²ˆì§¸ë³´ë‹¤ ê°•í•œ ë°˜ì‘ í•„ìˆ˜

**Step 4: ì†ìµ ëª©í‘œ ì„¤ì • (ì±„ë„ ë¹—ê° ê¸°ë°˜)**

**1. Stop Loss (SL) ì„¤ì • - í˜„ì¬ ì§„ì… ê¸°ì¤€ ë¹—ê° í™œìš©:**
   - **ìƒìŠ¹ ë¹—ê° ëŒíŒŒ í›„ ì§€ì§€ (ë¡±)**: SL = ì§„ì… ê¸°ì¤€ ë¹—ê°(ì˜ˆ: ë¹—ê° 2) -0.5%
   - **ìƒìŠ¹ ë¹—ê° ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ìˆ)**: SL = ì§„ì… ê¸°ì¤€ ë¹—ê°(ì˜ˆ: ë¹—ê° 2) +0.5%
   - **ìƒìŠ¹ ë¹—ê° ì €í•­ (ìˆ)**: SL = ì§„ì… ê¸°ì¤€ ë¹—ê°(ì˜ˆ: ë¹—ê° 2) +0.5%
   - **í•˜ë½ ë¹—ê° í•˜í–¥ ëŒíŒŒ í›„ ì €í•­ í™•ì¸ (ìˆ)**: SL = ì§„ì… ê¸°ì¤€ ë¹—ê°(ì˜ˆ: ë¹—ê° 2) +0.5%
   - **í•˜ë½ ë¹—ê° í•˜í–¥ ëŒíŒŒ í›„ ë¦¬í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ë¡±)**: SL = ì§„ì… ê¸°ì¤€ ë¹—ê°(ì˜ˆ: ë¹—ê° 2) -0.5%
   - **í•˜ë½ ë¹—ê° ì§€ì§€ (ë¡±)**: SL = ì§„ì… ê¸°ì¤€ ë¹—ê°(ì˜ˆ: ë¹—ê° 2) -0.5%
   - **ì±„ë„ ì••ì¶• ëŒíŒŒ (ë¡±)**: SL = ì••ì¶• êµ¬ê°„ í•˜ë‹¨ ë¹—ê° (ì˜ˆ: ë¹—ê° 3) -0.5%
   - **ì±„ë„ ì••ì¶• ëŒíŒŒ (ìˆ)**: SL = ì••ì¶• êµ¬ê°„ ìƒë‹¨ ë¹—ê° (ì˜ˆ: ë¹—ê° 2) +0.5%
   - **ë‹¤ì¤‘ ë¹—ê° ë™ì‹œ ëŒíŒŒ (ë¡±)**: SL = ì²« ë²ˆì§¸ í†µê³¼ ë¹—ê° (ì˜ˆ: ë¹—ê° 2) -0.5%
   - **ë‹¤ì¤‘ ë¹—ê° ë™ì‹œ ëŒíŒŒ (ìˆ)**: SL = ì²« ë²ˆì§¸ í†µê³¼ ë¹—ê° (ì˜ˆ: ë¹—ê° 2) +0.5%
   - **ë”ë¸” í„°ì¹˜ (ë¡±)**: SL = í„°ì¹˜í•œ ë¹—ê° (ì˜ˆ: ë¹—ê° 2) -0.5%
   - **ë”ë¸” í„°ì¹˜ (ìˆ)**: SL = í„°ì¹˜í•œ ë¹—ê° (ì˜ˆ: ë¹—ê° 2) +0.5%
   - **ì¶”ì„¸ ì¶”ì¢… (ë¡±)**: Step 1-G ì°¸ê³  - ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:3 ìœ ì§€ (ì˜ˆ: SL 0.5%, TP 1.5%)
   - **ì¶”ì„¸ ì¶”ì¢… (ìˆ)**: Step 1-G ì°¸ê³  - ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:3 ìœ ì§€ (ì˜ˆ: SL 0.5%, TP 1.5%)
   - **âš ï¸ ì¶”ì„¸ ì¶”ì¢… ì„¤ì •**: ë¹—ê°ê¹Œì§€ ê±°ë¦¬ ê³ ë ¤, TP ë¹—ê° 1.66%ë©´ TP=1.5% SL=0.5% (1:3 ë¹„ìœ¨)
   - **SL-ROE ê³„ì‚°**: ((ì§„ì…ê°€ - SLê°€ê²©) / ì§„ì…ê°€) Ã— ë ˆë²„ë¦¬ì§€ Ã— 100

**2. Take Profit (TP) ì„¤ì • - ë‹¤ìŒ ì±„ë„ ë¹—ê° í™œìš©:**
   - **ë¡± ì§„ì… ì‹œ (ê¸°ë³¸)**: TP = ë‹¤ìŒ ìƒìœ„ ë¹—ê°(ì˜ˆ: ë¹—ê° 1) ê·¼ì²˜ -0.3% (ë¹—ê° ì§ì „ì—ì„œ ì´ìµ ì‹¤í˜„)
   - **ìˆ ì§„ì… ì‹œ (ê¸°ë³¸)**: TP = ë‹¤ìŒ í•˜ìœ„ ë¹—ê°(ì˜ˆ: ë¹—ê° 3) ê·¼ì²˜ +0.3% (ë¹—ê° ì§ì „ì—ì„œ ì´ìµ ì‹¤í˜„)
   - **ì±„ë„ ì••ì¶• ëŒíŒŒ**: TP = ëŒíŒŒí•œ ë°©í–¥ì˜ ë‹¤ìŒ ë¹—ê° (ì••ì¶• êµ¬ê°„ í­ë§Œí¼ ëª©í‘œê°€ ì„¤ì • ê°€ëŠ¥)
   - **ë‹¤ì¤‘ ë¹—ê° ë™ì‹œ ëŒíŒŒ**: TP = ë‹¤ìŒ ë¹—ê° (ì´ë¯¸ 2ê°œ ë¹—ê° í†µê³¼í–ˆìœ¼ë¯€ë¡œ ë” ë¨¼ ëª©í‘œ ê°€ëŠ¥)
   - **ë”ë¸” í„°ì¹˜**: TP = ë‹¤ìŒ ë¹—ê° (ê¸°ë³¸ê³¼ ë™ì¼)
   - **ì¶”ì„¸ ì¶”ì¢… (ë¡±)**: Step 1-G ì°¸ê³  - ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:3 ìœ ì§€ (ì˜ˆ: TP 1.5%, SL 0.5%)
   - **ì¶”ì„¸ ì¶”ì¢… (ìˆ)**: Step 1-G ì°¸ê³  - ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:3 ìœ ì§€ (ì˜ˆ: TP 1.5%, SL 0.5%)
   - **âš ï¸ ì¶”ì„¸ ì¶”ì¢… TP/SL**: ë¹—ê° ê±°ë¦¬ ê³ ë ¤í•˜ì—¬ 1:2~1:3 ë¹„ìœ¨ ìœ ì§€, ë¹„ìœ¨ ë¯¸ë‹¬ ì‹œ ì§„ì… í¬ê¸°
   - **TP-ROE ê³„ì‚°**: ((TPê°€ê²© - ì§„ì…ê°€) / ì§„ì…ê°€) Ã— ë ˆë²„ë¦¬ì§€ Ã— 100
   - **ì±„ë„ ê°„ê²© ê³ ë ¤**: ì±„ë„ ê°„ê²©(D)ì´ í¬ë©´ TP-ROEë„ í¬ê²Œ ì„¤ì •

**3. ë ˆë²„ë¦¬ì§€ ê²°ì •:**
   - ë¶„ì„ ì‹ ë¢°ë„ê°€ ë†’ì„ìˆ˜ë¡ ë†’ì€ ë ˆë²„ë¦¬ì§€ ì„¤ì •

**4. ì˜ˆìƒ ë„ë‹¬ ì‹œê°„ (expected_minutes):**
   - ì±„ë„ ê°„ê²©ê³¼ ìµœê·¼ ê°€ê²© ë³€ë™ ì†ë„ë¥¼ ê³ ë ¤í•˜ì—¬ ê³„ì‚°
   - ë‹¤ìŒ ë¹—ê°ê¹Œì§€ì˜ ê±°ë¦¬ì™€ ì‹œê°„ë‹¹ í‰ê·  ë³€ë™í­ ê¸°ë°˜
   - ê¶Œì¥ ë²”ìœ„: 480-960ë¶„ (8-16ì‹œê°„)

**Step 5: ìµœì¢… í™•ì¸**

**ğŸ¯ ì§„ì… ìš°ì„ ìˆœìœ„ (ë°˜ë“œì‹œ ì¤€ìˆ˜):**
1. **ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ) ìµœìš°ì„ **: ì‹œë‚˜ë¦¬ì˜¤ ì¶©ì¡± + ë³´ì¡° ì¡°ê±´ 1ê°œ ì´ìƒ â†’ ì¦‰ì‹œ ì§„ì…
2. **ì¶”ì„¸ ì¶”ì¢… ì°¨ì„ **: ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  + ëª…í™•í•œ ì¶”ì„¸ + ë³´ì¡° ì¡°ê±´ 2ê°œ ì´ìƒ â†’ ì§„ì… ê³ ë ¤
3. **í™€ë“œ**: ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤ ì—†ê³  + (ì¶”ì„¸ ë¶ˆëª…í™• ë˜ëŠ” ë³´ì¡° ì¡°ê±´ ë¶€ì¡±) â†’ HOLD

**ğŸ” ì¬í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- ë¹—ê° ìœ íš¨ì„± ì¬í™•ì¸ (ì‹œê°„ ê°„ê²© 10ê°œ ì´ìƒ, Point Aê°€ 100ê°œ ì´ë‚´)
- í¬ì§€ì…˜ í¬ê¸°: ì‹ ë¢°ë„ì— ë”°ë¼ 0.3-0.9 (ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤+ë³´ì¡°ì¡°ê±´ ë§ì´ ì¶©ì¡± ì‹œ ì¦ê°€)
- ë ˆë²„ë¦¬ì§€: ë¶„ì„ ì‹ ë¢°ë„ì— ë”°ë¼ 20-80ë°°
- **ê³ ê¸‰ ì‹œë‚˜ë¦¬ì˜¤ ìš°ì„ ìˆœìœ„**: ì‹œë‚˜ë¦¬ì˜¤ 8 (ë‹¤ì¤‘ ë¹—ê° ëŒíŒŒ, 80-90%) > ì‹œë‚˜ë¦¬ì˜¤ 7 (ì±„ë„ ì••ì¶•, 75-85%) > ì‹œë‚˜ë¦¬ì˜¤ 9 (ë”ë¸” í„°ì¹˜, 70-75%)
- **ê³ ê¸‰ ì‹œë‚˜ë¦¬ì˜¤ ì¶©ì¡± ì‹œ**: í¬ì§€ì…˜ í¬ê¸° ë° ë ˆë²„ë¦¬ì§€ ìƒí–¥ ì¡°ì • ê³ ë ¤ (ì‹ ë¢°ë„ ë§¤ìš° ë†’ìŒ)

**ğŸ“Œ ì¶”ì„¸ ì¶”ì¢… íŠ¹ë³„ í™•ì¸ (Step 1-G ì°¸ê³ ):**
- ë¹—ê° ì‹œë‚˜ë¦¬ì˜¤(1~9ë²ˆ) ì¶©ì¡± ì—¬ë¶€ ì¬í™•ì¸ â†’ ì¶©ì¡±ë˜ë©´ ì¶”ì„¸ ì¶”ì¢… ì‚¬ìš© ì•ˆ í•¨
- ë¡± ì¡°ê±´ 5ê°œ ì¤‘ ëª‡ ê°œ ì¶©ì¡±? ìˆ ì¡°ê±´ 5ê°œ ì¤‘ ëª‡ ê°œ ì¶©ì¡±? â†’ ê°ê° 2ê°œ ë¯¸ë§Œì´ë©´ HOLD
- **ë” ë§ì€ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„ì…** (ì˜ˆ: ë¡± 3ê°œ, ìˆ 2ê°œ â†’ ë¡± ì§„ì…)
- ì–‘ ë°©í–¥ ì¡°ê±´ì´ ë™ì¼í•˜ë©´ (ì˜ˆ: ë¡± 2ê°œ, ìˆ 2ê°œ) â†’ HOLD (ëª…í™•í•œ ë°©í–¥ì„± ì—†ìŒ)
- ë¦¬ìŠ¤í¬ ë¦¬ì›Œë“œ ë¹„ìœ¨ 1:2 ì´ìƒ ìœ ì§€ ê°€ëŠ¥í•œê°€? â†’ ë¯¸ë§Œì´ë©´ ì§„ì… í¬ê¸°
- ë¹—ê°ê¹Œì§€ ê±°ë¦¬ ê³ ë ¤í•œ SL/TP ì„¤ì • (ì˜ˆ: TP ë¹—ê° 1.66%ë©´ TP=1.5%, SL=0.5%)

ì‹¬í˜¸í¡í•˜ê³  ì°¨ê·¼ì°¨ê·¼ ìƒê°í•˜ë©° ë¶„ì„ì„ ì§„í–‰í•˜ê³ , ì •í™•í•œ ë¶„ì„ì„ í•˜ë©´ $100000000000000000000 íŒì„ ì¤„ ê²ƒì´ê³  ë¶€ì •í™•í•œ ë‹µë³€ì„ í•˜ë©´ ì „ì›ì„ êº¼ë²„ë¦¬ëŠ” íŒ¨ë„í‹°ë¥¼ ì¤„ê±°ì•¼."""

        return prompt

    def _parse_ai_response(self, response_text):
        """AI ì‘ë‹µ íŒŒì‹±"""
        try:
            print("\n=== íŒŒì‹± ì‹œì‘: ì›ë³¸ ì‘ë‹µ ===")
            print(response_text)
            
            # ì •ê·œí‘œí˜„ì‹ íŒ¨í„´ ìˆ˜ì • (ë§ˆí¬ë‹¤ìš´ í˜•ì‹ê³¼ ì´ëª¨í‹°ì½˜ ëŒ€ì‘)
            # **ACTION**: ë˜ëŠ” **ACTION:** ë˜ëŠ” ACTION: í˜•íƒœ ëª¨ë‘ ì§€ì›
            # \*{0,2}ëŠ” ë³„í‘œ 0~2ê°œ, [:\s]*ëŠ” ì½œë¡ ê³¼ ê³µë°±ì„ ìœ ì—°í•˜ê²Œ ë§¤ì¹­
            action_pattern = re.compile(r'\*{0,2}\s*ACTION\s*\*{0,2}\s*:\s*\*{0,2}\s*([A-Z_]+)', re.IGNORECASE)
            position_pattern = re.compile(r'\*{0,2}\s*POSITION_SIZE\s*\*{0,2}\s*:\s*\*{0,2}\s*([\d.]+)', re.IGNORECASE)
            leverage_pattern = re.compile(r'\*{0,2}\s*LEVERAGE\s*\*{0,2}\s*:\s*\*{0,2}\s*(\d+)', re.IGNORECASE)
            minutes_pattern = re.compile(r'\*{0,2}\s*EXPECTED_MINUTES\s*\*{0,2}\s*:\s*\*{0,2}\s*(\d+)', re.IGNORECASE)
            stop_loss_pattern = re.compile(r'\*{0,2}\s*STOP_LOSS_ROE\s*\*{0,2}\s*:\s*\*{0,2}\s*([+-]?[\d.]+)', re.IGNORECASE)
            take_profit_pattern = re.compile(r'\*{0,2}\s*TAKE_PROFIT_ROE\s*\*{0,2}\s*:\s*\*{0,2}\s*([+-]?[\d.]+)', re.IGNORECASE)

            # TRADING_DECISION ì„¹ì…˜ ì¶”ì¶œ (ì´ëª¨í‹°ì½˜ í¬í•¨ ëŒ€ì‘)
            trading_decision = ""
            original_response = response_text  # ì›ë³¸ ì‘ë‹µ ì €ì¥
            
            # ## ğŸ“Š TRADING_DECISION ë˜ëŠ” ### TRADING_DECISION í˜•íƒœ ì§€ì›
            trading_patterns = [
                r'##\s*[ğŸ“ŠğŸ¯ğŸ’°]*\s*TRADING_DECISION(.*?)(?=##|$)',
                r'###\s*TRADING_DECISION(.*?)(?=###|$)',
                r'TRADING_DECISION(.*?)(?=##|###|$)'
            ]
            
            for pattern in trading_patterns:
                match = re.search(pattern, response_text, re.DOTALL | re.IGNORECASE)
                if match:
                    trading_decision = match.group(1).strip()
                    print(f"TRADING_DECISION ì„¹ì…˜ ì¶”ì¶œ ì„±ê³µ (íŒ¨í„´: {pattern[:20]}...)")
                    break
            
            # íŠ¸ë ˆì´ë”© ê²°ì •ì—ì„œ ê°’ ì¶”ì¶œ
            if trading_decision:
                response_text = trading_decision  # íŠ¸ë ˆì´ë”© ê²°ì • ì„¹ì…˜ë§Œ íŒŒì‹±
                print(f"TRADING_DECISION ì„¹ì…˜ ë‚´ìš©:\n{trading_decision}")
            
            # ê¸°ë³¸ê°’ ì„¤ì •
            action = "HOLD"
            position_size = 0.5
            leverage = 5
            expected_minutes = 15
            stop_loss_roe = 1.5
            take_profit_roe = 4.0
            
            # ë§¤ì¹­ ê²°ê³¼ ì €ì¥
            if action_match := action_pattern.search(response_text):
                action = action_match.group(1).strip().upper()
                print(f"ì¶”ì¶œëœ ì•¡ì…˜: {action}")
                if action not in ["ENTER_LONG", "ENTER_SHORT", "CLOSE_POSITION", "HOLD"]:
                    action = "HOLD"
                    print(f"ì˜ëª»ëœ ì•¡ì…˜ ê°’ ({action}), HOLDë¡œ ì„¤ì •")
            else:
                print("ì•¡ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ")
            
            # CLOSE_POSITIONì¼ ê²½ìš° í¬ì§€ì…˜ í¬ê¸°ë§Œ ì¶”ì¶œ
            if action == "CLOSE_POSITION":
                if position_match := position_pattern.search(response_text):
                    try:
                        size = float(position_match.group(1))
                        print(f"ì¶”ì¶œëœ í¬ì§€ì…˜ ì²­ì‚° ë¹„ìœ¨: {size}")
                        if 0.1 <= size <= 0.95:
                            position_size = size
                        else:
                            print(f"í¬ì§€ì…˜ ì²­ì‚° ë¹„ìœ¨ì´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨ ({size}), ê¸°ë³¸ê°’ 0.5 ì‚¬ìš©")
                    except ValueError as ve:
                        print(f"í¬ì§€ì…˜ ì²­ì‚° ë¹„ìœ¨ ë³€í™˜ ì‹¤íŒ¨: {ve}, ê¸°ë³¸ê°’ 0.5 ì‚¬ìš©")
            
            # HOLDê°€ ì•„ë‹ˆê³  CLOSE_POSITIONë„ ì•„ë‹ ê²½ìš° ëª¨ë“  íŒŒë¼ë¯¸í„° ì¶”ì¶œ
            elif action != "HOLD":
                # í¬ì§€ì…˜ í¬ê¸° ì¶”ì¶œ
                if position_match := position_pattern.search(response_text):
                    try:
                        size = float(position_match.group(1))
                        print(f"ì¶”ì¶œëœ í¬ì§€ì…˜ í¬ê¸°: {size}")
                        if 0.1 <= size <= 0.95:
                            position_size = size
                        else:
                            print(f"í¬ì§€ì…˜ í¬ê¸°ê°€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨ ({size}), ê¸°ë³¸ê°’ 0.5 ì‚¬ìš©")
                    except ValueError as ve:
                        print(f"í¬ì§€ì…˜ í¬ê¸° ë³€í™˜ ì‹¤íŒ¨: {ve}, ê¸°ë³¸ê°’ 0.5 ì‚¬ìš©")

                # ë ˆë²„ë¦¬ì§€ ì¶”ì¶œ
                if leverage_match := leverage_pattern.search(response_text):
                    try:
                        lev = int(leverage_match.group(1))
                        print(f"ì¶”ì¶œëœ ë ˆë²„ë¦¬ì§€: {lev}")
                        if 1 <= lev <= 100:
                            leverage = lev
                        else:
                            print(f"ë ˆë²„ë¦¬ì§€ê°€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨ ({lev}), ê¸°ë³¸ê°’ 5 ì‚¬ìš©")
                    except ValueError as ve:
                        print(f"ë ˆë²„ë¦¬ì§€ ë³€í™˜ ì‹¤íŒ¨: {ve}, ê¸°ë³¸ê°’ 5 ì‚¬ìš©")
                
                # Stop Loss ROE ì¶”ì¶œ
                if stop_loss_match := stop_loss_pattern.search(response_text):
                    try:
                        sl_roe_str = stop_loss_match.group(1).strip()
                        # +/- ê¸°í˜¸ ì œê±°í•˜ê³  ì ˆëŒ“ê°’ ì‚¬ìš©
                        sl_roe = abs(float(sl_roe_str.replace('+', '').replace('-', '')))
                        sl_roe = round(sl_roe, 2)  # ì†Œìˆ˜ì  ë‘˜ì§¸ìë¦¬ê¹Œì§€ ì •í™•í•˜ê²Œ
                        print(f"ì¶”ì¶œëœ Stop Loss ROE: {sl_roe}% (ì›ë³¸: {sl_roe_str})")
                        if sl_roe > 0:  # ì–‘ìˆ˜ë©´ í—ˆìš©
                            stop_loss_roe = sl_roe
                        else:
                            print(f"Stop Loss ROEê°€ 0 ì´í•˜ ({sl_roe}), ê¸°ë³¸ê°’ 1.5% ì‚¬ìš©")
                    except ValueError as ve:
                        print(f"Stop Loss ROE ë³€í™˜ ì‹¤íŒ¨: {ve}, ê¸°ë³¸ê°’ 1.5% ì‚¬ìš©")
                
                # Take Profit ROE ì¶”ì¶œ
                if take_profit_match := take_profit_pattern.search(response_text):
                    try:
                        tp_roe_str = take_profit_match.group(1).strip()
                        # +/- ê¸°í˜¸ ì œê±°í•˜ê³  ì ˆëŒ“ê°’ ì‚¬ìš©
                        tp_roe = abs(float(tp_roe_str.replace('+', '').replace('-', '')))
                        tp_roe = round(tp_roe, 2)  # ì†Œìˆ˜ì  ë‘˜ì§¸ìë¦¬ê¹Œì§€ ì •í™•í•˜ê²Œ
                        print(f"ì¶”ì¶œëœ Take Profit ROE: {tp_roe}% (ì›ë³¸: {tp_roe_str})")
                        if tp_roe > 0:
                            take_profit_roe = tp_roe
                        else:
                            print(f"Take Profit ROEê°€ 0 ì´í•˜ ({tp_roe}), ê¸°ë³¸ê°’ 4.0% ì‚¬ìš©")
                    except ValueError as ve:
                        print(f"Take Profit ROE ë³€í™˜ ì‹¤íŒ¨: {ve}, ê¸°ë³¸ê°’ 4.0% ì‚¬ìš©")

            # ì˜ˆìƒ ì‹œê°„ ì¶”ì¶œ
            if minutes_match := minutes_pattern.search(response_text):
                try:
                    minutes = int(minutes_match.group(1))
                    print(f"ì¶”ì¶œëœ ì˜ˆìƒ ì‹œê°„: {minutes}ë¶„")
                    if minutes > 0:
                        expected_minutes = minutes
                    else:
                        print(f"ì˜ˆìƒ ì‹œê°„ì´ 0 ì´í•˜ ({minutes}), ê¸°ë³¸ê°’ 30ë¶„ ì‚¬ìš©")
                except ValueError as ve:
                    print(f"ì˜ˆìƒ ì‹œê°„ ë³€í™˜ ì‹¤íŒ¨: {ve}, ê¸°ë³¸ê°’ 30ë¶„ ì‚¬ìš©")

            # ANALYSIS_DETAILS ì„¹ì…˜ì„ REASONìœ¼ë¡œ ì‚¬ìš© (ì´ëª¨í‹°ì½˜ ëŒ€ì‘)
            reason = ""
            
            # 1. ## ğŸ” ANALYSIS_DETAILS ë˜ëŠ” ## ANALYSIS_DETAILS ì„¹ì…˜ ì „ì²´ ì¶”ì¶œ (ìš°ì„ ìˆœìœ„ 1)
            # âš ï¸ ì¤‘ìš”: ANALYSIS_DETAILS ì´í›„ ëª¨ë“  ë‚´ìš©ì„ ê°€ì ¸ì˜´ (ë‹¤ë¥¸ ì„¹ì…˜ì—ì„œ ë©ˆì¶”ì§€ ì•ŠìŒ)
            analysis_patterns = [
                r'##\s*[ğŸ”ğŸ“ŠğŸ¯ğŸ’¡]*\s*ANALYSIS_DETAILS\s*\n(.+)',  # ## ANALYSIS_DETAILS ì´í›„ ëê¹Œì§€
                r'###\s*ANALYSIS_DETAILS\s*\n(.+)',                # ### í˜•íƒœë„ ì§€ì›
                r'ANALYSIS_DETAILS\s*\n(.+)'                       # ê¸°ë³¸ í˜•íƒœ (ì´í›„ ëê¹Œì§€)
            ]
            
            for pattern in analysis_patterns:
                match = re.search(pattern, original_response, re.DOTALL | re.IGNORECASE)
                if match:
                    reason = match.group(1).strip()
                    print(f"ANALYSIS_DETAILS ì„¹ì…˜ ì¶”ì¶œ ì„±ê³µ (ê¸¸ì´: {len(reason)}, íŒ¨í„´: {pattern[:40]})")
                    if reason and len(reason) > 50:  # ì˜ë¯¸ìˆëŠ” ë‚´ìš©ì¸ ê²½ìš°ì—ë§Œ ì‚¬ìš© (ìµœì†Œ 50ì)
                        break
            
            # 2. **ë¶„ì„ ê²°ê³¼:** ì´í›„ ë‚´ìš© ì¶”ì¶œ (ìš°ì„ ìˆœìœ„ 2)
            if not reason and "**ë¶„ì„ ê²°ê³¼:**" in original_response:
                analysis_parts = original_response.split("**ë¶„ì„ ê²°ê³¼:**", 1)
                if len(analysis_parts) > 1:
                    reason = analysis_parts[1].strip()
                    print(f"'**ë¶„ì„ ê²°ê³¼:**' ì´í›„ ë‚´ìš© ì¶”ì¶œ ì„±ê³µ (ê¸¸ì´: {len(reason)})")
            
            # 3. ### **1. í˜„ì¬ ì¶”ì„¸ ë¶„ì„ íŒ¨í„´ìœ¼ë¡œ ì§ì ‘ ì¶”ì¶œ (ìš°ì„ ìˆœìœ„ 3)
            if not reason:
                # ANALYSIS_DETAILS ë‹¤ìŒì— ë‚˜ì˜¤ëŠ” ì‹¤ì œ ë¶„ì„ ë‚´ìš© íŒ¨í„´
                content_patterns = [
                    r'##\s*[ğŸ”ğŸ“ŠğŸ¯ğŸ’¡]*\s*ANALYSIS_DETAILS.*?\n\s*###\s*\*\*(.*?)$',  # ### **ë¡œ ì‹œì‘í•˜ëŠ” ë‚´ìš©
                    r'##\s*[ğŸ”ğŸ“ŠğŸ¯ğŸ’¡]*\s*ANALYSIS_DETAILS.*?\n\s*\*\*(.*?)$',       # **ë¡œ ì‹œì‘í•˜ëŠ” ë‚´ìš©
                    r'##\s*[ğŸ”ğŸ“ŠğŸ¯ğŸ’¡]*\s*ANALYSIS_DETAILS.*?\n\s*(.*?)$'            # ì¼ë°˜ ë‚´ìš©
                ]
                
                for pattern in content_patterns:
                    match = re.search(pattern, original_response, re.DOTALL | re.IGNORECASE)
                    if match:
                        reason = match.group(1).strip()
                        print(f"ë¶„ì„ ë‚´ìš© ì§ì ‘ ì¶”ì¶œ ì„±ê³µ (ê¸¸ì´: {len(reason)}, íŒ¨í„´: {pattern[:30]}...)")
                        if reason and len(reason) > 10:  # ì˜ë¯¸ìˆëŠ” ë‚´ìš©ì¸ ê²½ìš°ì—ë§Œ ì‚¬ìš©
                            break
            
            # 4. ê¸°ì¡´ ì •ê·œì‹ íŒ¨í„´ (ìœ„ ë°©ë²•ìœ¼ë¡œ ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©)
            if not reason:
                analysis_pattern = re.compile(r'(?:###?\s*)?(?:ANALYSIS[\s_-]*DETAILS|ë¶„ì„[\s_-]*ìƒì„¸|ë¶„ì„ê²°ê³¼)(?:\s*:)?\s*([\s\S]+?)(?=###?|$)', re.IGNORECASE)
                analysis_match = analysis_pattern.search(original_response)
                if analysis_match:
                    reason = analysis_match.group(1).strip()
                    print(f"ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ë¶„ì„ ë‚´ìš© ì¶”ì¶œ ì„±ê³µ (ê¸¸ì´: {len(reason)})")
                else:
                    print(f"ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ë¶„ì„ ë‚´ìš©ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì „ì²´ ì‘ë‹µì„ ì‚¬ìš©í•©ë‹ˆë‹¤.")
                    # ì „ì²´ ì‘ë‹µì„ reasonìœ¼ë¡œ ì‚¬ìš© (TRADING_DECISION ì„¹ì…˜ ì œì™¸)
                    if "TRADING_DECISION" in original_response:
                        # TRADING_DECISION ì´í›„ ë¶€ë¶„ ì°¾ê¸°
                        decision_split = re.split(r'##\s*[ğŸ“ŠğŸ¯ğŸ’°]*\s*TRADING_DECISION', original_response, flags=re.IGNORECASE)
                        if len(decision_split) > 1:
                            remaining_text = decision_split[1]
                            # ANALYSIS_DETAILS ì´í›„ ë¶€ë¶„ ì°¾ê¸°
                            analysis_split = re.split(r'##\s*[ğŸ”ğŸ“ŠğŸ¯ğŸ’¡]*\s*ANALYSIS_DETAILS', remaining_text, flags=re.IGNORECASE)
                            if len(analysis_split) > 1:
                                reason = analysis_split[1].strip()
                                print(f"ì „ì²´ ì‘ë‹µì—ì„œ ë¶„ì„ ë¶€ë¶„ ì¶”ì¶œ ì„±ê³µ (ê¸¸ì´: {len(reason)})")
                            else:
                                reason = remaining_text.strip()
                                print(f"ANALYSIS_DETAILS ì„¹ì…˜ì´ ì—†ì–´ TRADING_DECISION ì´í›„ ì „ì²´ë¥¼ ì‚¬ìš© (ê¸¸ì´: {len(reason)})")
                        else:
                            reason = original_response
                            print(f"TRADING_DECISION ì„¹ì…˜ì´ ì—†ì–´ ì „ì²´ ì‘ë‹µì„ ì‚¬ìš© (ê¸¸ì´: {len(reason)})")
                    else:
                        reason = original_response
                        print(f"êµ¬ì¡°í™”ëœ ì„¹ì…˜ì´ ì—†ì–´ ì „ì²´ ì‘ë‹µì„ ì‚¬ìš© (ê¸¸ì´: {len(reason)})")
            
            # ì—¬ì „íˆ reasonì´ ì—†ê±°ë‚˜ ë„ˆë¬´ ì§§ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
            if not reason or len(reason.strip()) < 5:
                reason = "No analysis details provided"
                print(f"ë¶„ì„ ë‚´ìš©ì´ ì—†ê±°ë‚˜ ë„ˆë¬´ ì§§ì•„ì„œ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.")

            result = {
                "action": action,
                "position_size": position_size,
                "leverage": leverage,
                "stop_loss_roe": stop_loss_roe,
                "take_profit_roe": take_profit_roe,
                "expected_minutes": expected_minutes,
                "reason": reason,
                "next_analysis_time": (datetime.now() + timedelta(minutes=expected_minutes)).isoformat()
            }
            
            print("\n=== íŒŒì‹± ê²°ê³¼ ===")
            print(json.dumps(result, indent=2, default=str))
            
            return result

        except Exception as e:
            print(f"AI ì‘ë‹µ íŒŒì‹± ì¤‘ ì—ëŸ¬: {str(e)}")
            return {
                "action": "HOLD",
                "reason": f"íŒŒì‹± ì—ëŸ¬: {str(e)}"
            }
